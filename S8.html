<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVA Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
        /* General Setup and Mobile-First Design */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Section */
        .header {
            background-color: #038203; /* Green */
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .profile-photo {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #fff;
            margin-right: 8px;
            border: 2px solid white;
            background-size: cover !important;
            background-position: center !important;
            flex-shrink: 0;
            cursor: pointer;
        }
        
        /* WITHDRAW: Back button style */
        .back-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }


        .username {
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 10px;
        }

        .logout-icon i {
            font-size: 1.2em;
            cursor: pointer;
        }

        .app-title {
            font-size: 1.5em;
            font-weight: 900;
            text-transform: uppercase;
            text-align: center;
            flex-grow: 1;
        }
        
        /* Earning Section (MODIFIED for LV on right) */
        .earning-section {
            display: flex; /* Use flex to put elements side-by-side */
            justify-content: space-between; /* Space out the earning and LV sections */
            align-items: center;
            padding: 12px 15px; /* Added horizontal padding */
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .earning-display {
            display: flex;
            align-items: center;
            color: #038203;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .earning-section h2 { /* Targeting the earning amount */
            margin: 0;
            color: #038203;
            font-size: 1.8em; /* Adjusted size for better layout */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* Style for the â‚± symbol and eye icon */
        .earning-section h2 span {
             font-size: 1em; /* keeps the number size standard */
        }
        
        .earning-section h2 i {
             font-size: 0.7em;
             margin-right: 10px;
             cursor: pointer;
             color: #333; /* Darker eye icon */
        }
        .earning-section h2 #currency-symbol {
             font-size: 0.7em;
             margin-left: 5px;
             font-weight: bold;
             align-self: flex-end; 
             padding-bottom: 2px;
        }
        
        /* New LV Option Styles */
        #levelOption {
            text-align: center;
            cursor: pointer;
            color: #333;
            font-size: 0.9em;
            font-weight: bold;
            display: flex;
            align-items: center;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background-color: #f9f9f9;
        }
        #levelOption i {
            margin-right: 5px;
            color: #038203;
            font-size: 1.2em;
        }


        /* Quick Options Styles */
        .quick-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            padding: 10px 5px;
            /* CHANGE 2: Increased top margin from 10px to 20px */
            margin: 20px auto 10px auto; 
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            max-width: 95%;
        }

        .quick-option {
            flex: 0 0 33.33%;
            text-align: center;
            padding: 10px 0;
            box-sizing: border-box;
            text-decoration: none;
            color: #333;
            cursor: pointer; /* Added cursor for better UX */
        }

        .quick-option i {
            font-size: 1.6em;
            color: #038203;
            display: block;
            margin-bottom: 4px;
        }

        .quick-option span {
            font-size: 0.75em;
            font-weight: normal;
            display: block;
            text-transform: uppercase;
        }

        /* Main Content Wrapper */
        .main-content {
            flex-grow: 1;
            order: 2;
            padding-bottom: 20px; 
        }

        /* Banner Section (Fixed Image) */
        /* --- BANNER CAROUSEL STYLES --- */
        .banner-container {
            position: relative; 
            margin: 15px;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* Set height relative to width for 2560x1440 ratio (1440/2560 = 0.5625) */
            padding-top: 56.25%; /* Fixed height for the banner */
            height: 0; /* Important for padding-top trick */
        }
        
        .banner-carousel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .banner-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease-in-out; /* Simple fade animation */
        }
        
        .banner-item.active {
            opacity: 1;
        }

        .banner-item img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensures the image covers the area */
            display: block;
        }

        .banner-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            z-index: 10;
            padding: 0 5px;
        }

        .banner-nav button {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 50%;
            font-size: 1.2em;
            line-height: 1;
            transition: background 0.2s;
        }
        
        .banner-nav button:hover {
            background: rgba(0, 0, 0, 0.8);
        }
        /* --- END BANNER CAROUSEL STYLES --- */

        /* Footer Messages (BEST OF LUCK) */
        .message-section {
            text-align: center;
            padding: 10px 15px;
            margin-top: 10px;
        }

        .big-message {
            font-size: 2em;
            font-weight: bold;
            color: #038203;
            margin-bottom: 0;
        }
        
        /* Footer Contact Details */
        .footer-contact {
            padding: 15px 10px;
            text-align: center;
            font-size: 0.8em;
            color: #555;
            background-color: #fff;
            border-top: 1px solid #ddd;
            order: 4;
        }

        .footer-contact p {
            margin: 5px 0;
        }

        .contact-link {
            display: inline-block;
            margin: 0 8px;
            color: #038203;
            text-decoration: none;
            font-weight: bold;
        }
        
        .contact-link i {
            font-size: 1.1em;
            vertical-align: middle;
            margin-right: 4px;
        }

        /* --- New Styles for Auth Forms --- */
        .auth-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-color: #f4f4f4;
            order: 2;
        }

        .auth-box {
            background-color: white;
            padding: 30px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 350px;
            text-align: center;
        }

        .auth-box h2 {
            margin-top: 0;
            color: #038203;
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .auth-box input[type="text"],
        .auth-box input[type="password"],
        .auth-box input[type="email"] { 
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }

        .auth-box button {
            background-color: #038203;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
            transition: background-color 0.2s;
        }

        .auth-box button:hover {
            background-color: #026b02;
        }

        .toggle-link {
            color: #007bff;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }

        /* Hide elements by default - controlled by JS */
        .hidden {
            display: none !important;
        }
        
        /* Message Styles (Enhanced) */
        .message {
            color: red;
            margin-bottom: 15px;
            font-size: 0.9em;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid red;
        }
        .message.success {
            color: white; 
            background-color: #038203; 
            border-color: #038203;
        }
        .message.error { 
            color: white;
            background-color: #d9534f; 
            border-color: #d9534f;
        }
        .message.info {
            color: orange;
            border-color: orange;
        }

        /* --- NEW STYLES FOR DASHBOARD PAGES (WITHDRAW, PROFILE, etc.) --- */
        .dashboard-page {
            padding: 15px;
            margin: 15px auto;
            max-width: 95%;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .dashboard-page h3 {
            color: #038203;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 0.9em;
        }
        
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        /* PROFILE: Username Count in Placeholder fix */
        #profileUsername {
            margin-bottom: 15px !important; /* Reset margin bottom */
        }

        .btn-green {
            background-color: #038203;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.2s;
        }

        .btn-green:hover {
            background-color: #026b02;
        }

        /* PROFILE: Remove separate count element */
        #usernameCharCount {
            display: none !important;
        }
        
        /* New Photo Frame button style (retained for generic button style) */
        .profile-option-button {
            background-color: #f4f4f4;
            color: #333;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        .profile-option-button:hover {
            background-color: #eee;
        }

        /* Team Section Styles */
        .referral-box {
            text-align: center;
            margin-bottom: 20px;
        }
        .referral-box label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 0.9em;
        }
        /* TEAM 1: Removed white line (dashed border/light bg) */
        .referral-code {
            padding: 10px;
            border-radius: 4px;
            font-size: 1.2em;
            font-weight: bold;
            color: #038203;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        /* TEAM 2 & 3: Simplified Stat Display */
        .team-stats-block {
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .team-stats-block label {
            font-size: 0.9em;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }
        #totalRefersCountDisplay {
            font-size: 1.8em;
            font-weight: bold;
            color: #038203;
            margin-top: 5px;
        }
        

        .referral-price {
            margin: 15px 0 20px;
            font-weight: bold;
            color: #555;
            font-size: 0.9em;
            padding: 10px;
            background-color: #e6ffe6;
            border-radius: 4px;
            text-align: center;
        }

        .referral-list-container {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid #eee;
        }
        .referral-list-container h4 {
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #333;
        }
        .ref-member {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .ref-member:last-child {
            border-bottom: none;
        }
        .member-detail {
            display: flex;
            flex-direction: column;
        }
        .member-detail strong {
            font-size: 1em;
            color: #038203;
        }
        .member-date {
            font-size: 0.8em;
            color: #888;
        }
        .member-photo {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ddd;
            margin-right: 10px;
            background-size: cover;
            background-position: center;
        }
        .ref-member-info {
            flex-grow: 1;
            display: flex;
            align-items: center;
        }

        /* Help Specific Styles (No change needed) */
        .contact-info-block {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
        }
        .contact-info-block label {
            font-size: 0.8em;
            color: #777;
            margin-bottom: 2px;
        }
        .contact-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            word-break: break-all;
        }

        .faq-item {
            margin-bottom: 10px;
            border: 1px solid #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }
        .faq-question {
            background-color: #e6ffe6;
            padding: 10px;
            cursor: pointer;
            font-weight: bold;
            color: #038203;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .faq-answer {
            padding: 10px;
            background-color: #fff;
            font-size: 0.9em;
            display: none;
        }
        
        /* Rank Page Styles: Cleaned up to be empty */
        #rankPage .rank-card {
            background-color: #f0f0f0;
            color: #333;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
        }
        #rankPage .rank-card h4 {
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 1.5em;
        }
        #rankPage .rank-card p {
            margin: 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* ðŸš¨ NEW STYLES FOR OVERLAYS (Ban, Photo Selection, and Frame Selection) */
        #banOverlay, #photoSelectionOverlay, #frameSelectionOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Background Blur */
            backdrop-filter: blur(8px); 
            background-color: rgba(0, 0, 0, 0.7); /* Dark overlay */
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .ban-box, .photo-box, .frame-box {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            max-width: 90%;
            width: 350px;
            text-align: left; /* Reset text-align for content */
        }

        .ban-box h2 {
            color: #dc3545; /* Red for Ban */
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        /* Photo and Frame Box common H3 style */
        .photo-box h3, .frame-box h3 {
            color: #038203;
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            font-size: 1.2em;
            text-align: center;
        }

        .ban-info p {
            font-size: 0.9em;
            margin: 10px 0;
            color: #555;
            word-break: break-all;
        }

        .ban-info strong {
            color: #333;
            display: inline-block;
            min-width: 80px;
            text-align: left;
            font-weight: bold;
        }
        
        /* Added for the new login button */
        .btn-secondary {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 1em;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #2980b9;
        }
        
        /* --- Photo & Frame Selection Grid Nav Styles --- */
        .photo-grid-nav, .frame-grid-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .photo-grid-nav button, .frame-grid-nav button {
            background: #f4f4f4;
            border: 1px solid #ccc;
            color: #333;
            padding: 5px 15px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .photo-grid-nav button.active, .frame-grid-nav button.active {
            background-color: #038203;
            color: white;
            border-color: #038203;
        }
        
        .photo-grid, .frame-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start; /* Aligned to start to manage spacing */
            margin-bottom: 15px;
        }

        /* Photo and Frame Item common styles */
        .photo-item, .frame-item {
            flex: 0 0 calc(33.33% - 10px); /* 3 items per row with margin */
            margin: 5px; /* Unified margin */
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 50%;
            overflow: hidden;
            box-sizing: border-box;
            position: relative;
            aspect-ratio: 1 / 1; /* Ensures square shape */
        }
        
        .photo-item.selected {
            border-color: #007bff; /* Blue border for photo selection */
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
        }

        .frame-item.selected {
            border-color: #ffc107; /* Yellow/Gold border for frame selection */
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
        }
        
        /* Lock Icon/Overlay */
        .photo-item.locked::after, .frame-item.locked::after {
            content: "\f023"; /* FontAwesome Lock Icon */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            border-radius: 50%;
            z-index: 5;
        }


        .photo-item img {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
            aspect-ratio: 1 / 1; /* Ensures square shape */
        }

        /* Frame images/visuals (if needed) */
        .frame-item img {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: contain;
        }
        
        /* Photo and Frame display circle on the selection overlay */
        .photo-display-circle, .frame-display-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #ddd;
            display: block;
            margin: 0 auto 15px;
            border: 3px solid #038203;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        /* Actual frame element jo profile image ke upar aayega */
        #profileFrameOverlay {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            border-radius: 50%;
            pointer-events: none; /* Taa-kay neeche wali photo par click ho sake */
            z-index: 2; /* Photo se oopar */
            background-size: cover;
            background-position: center;
        }
        
        /* --- NEW FRAME VISUAL STYLES (Blush, Gold, Diamond, Animated) --- */

        /* Base style for all frames in the grid */
        .frame-item.frame-blush {
            /* Blush Frame: A soft pink/red gradient border */
            border: 3px solid transparent !important; 
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            background-origin: border-box;
            background-clip: padding-box, border-box;
            border-radius: 50%;
        }

        .frame-item.frame-gold {
            /* Gold Frame: A shiny metallic look */
            border: 3px solid transparent !important;
            background: linear-gradient(45deg, #f0e68c, #ffd700, #daa520, #f0e68c);
            background-origin: border-box;
            background-clip: padding-box, border-box;
            border-radius: 50%;
            background-size: 200% 200%; /* For movement */
            animation: goldShine 5s infinite linear; /* Added shine effect */
        }

        @keyframes goldShine {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .frame-item.frame-diamond {
            /* Diamond Frame: Sparkling blue/white border */
            border: 3px solid #b9f2ff !important; 
            box-shadow: 0 0 10px #b9f2ff, 0 0 20px rgba(0, 191, 255, 0.5);
        }

        .frame-item.frame-green-line {
            /* Default green border like the profile photo */
            border: 3px solid #038203 !important;
        }

        /* Animated Frame Example (Using a moving gradient) */
        .frame-item.frame-animated {
            border: 4px solid transparent !important; 
            background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            background-size: 400% 400%;
            border-radius: 50%;
            animation: movingRainbow 8s linear infinite;
        }

        @keyframes movingRainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        /* --- END NEW FRAME VISUAL STYLES --- */
        
        /* --- LV Page Styles --- */
        .lv-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .lv-item-info {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
        .lv-item.unlocked .lv-item-info {
             color: #038203;
        }
        .lv-right-side {
            display: flex;
            align-items: center;
            font-size: 0.9em;
        }
        .lv-right-side.locked span {
            color: #dc3545; /* Red for locked */
            font-weight: bold;
            margin-right: 10px;
        }
        .lv-right-side button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            cursor: pointer;
        }


        /* ðŸš¨ NEW STYLES for Profile Menu */
        .profile-menu-toggle-icon {
            position: absolute;
            bottom: 0px; /* Position below the circle */
            right: 50%;
            transform: translateX(65px); /* Adjusted to be slightly to the right of the circle center */
            font-size: 1.5em;
            color: #038203;
            cursor: pointer;
            background-color: white;
            padding: 8px;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .profile-option-menu {
            position: absolute;
            top: 20px; /* Aligned with the top of the profile circle */
            right: 0px; /* Right edge of the profile-upload-area */
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            width: 150px;
            padding: 5px 0;
            z-index: 50;
            text-align: left;
        }

        .menu-item {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 0.9em;
            color: #333;
            display: flex;
            align-items: center;
            transition: background-color 0.1s;
        }

        .menu-item i {
            margin-right: 10px;
            color: #038203;
        }

        .menu-item:hover {
            background-color: #f4f4f4;
        }
        
        .menu-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            color: #777;
        }
        
        /* --- NEW FRAME VISUAL STYLES (Agar aap frames ko sirf CSS se style karna chahein) --- */

/* Base style for all frames in the grid */
.frame-item.frame-blush {
    /* Blush Frame: A soft pink/red gradient border */
    border: 3px solid transparent !important; /* Base transparent border */
    background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
    background-origin: border-box;
    background-clip: padding-box, border-box;
    border-radius: 50%;
}

.frame-item.frame-gold {
    /* Gold Frame: A shiny metallic look */
    border: 3px solid transparent !important;
    background: linear-gradient(45deg, #f0e68c, #ffd700, #daa520, #f0e68c);
    background-origin: border-box;
    background-clip: padding-box, border-box;
    border-radius: 50%;
    animation: goldShine 5s infinite linear; /* Added shine effect */
}

@keyframes goldShine {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.frame-item.frame-diamond {
    /* Diamond Frame: Sparkling blue/white border */
    border: 3px solid #b9f2ff !important; 
    box-shadow: 0 0 10px #b9f2ff, 0 0 20px rgba(0, 191, 255, 0.5);
}

.frame-item.frame-green-line {
    /* Default green border like the profile photo */
    border: 3px solid #038203 !important;
}

/* Animated Frame Example (Using a moving gradient) */
.frame-item.frame-animated {
    border: 4px solid transparent !important; 
    background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
    background-size: 400% 400%;
    border-radius: 50%;
    animation: movingRainbow 8s linear infinite;
}

@keyframes movingRainbow {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
}
/* --- New Styles for Task History --- */
.history-item {
    padding: 10px 0;
    border-bottom: 1px solid #eee;
    margin-bottom: 5px;
    font-size: 0.9em;
}
.history-item:last-child {
    border-bottom: none;
}
.history-status {
    font-weight: bold;
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    margin-left: 10px;
}
.status-pending { background-color: orange; color: white; }
.status-rejected { background-color: #dc3545; color: white; }
.status-completed { background-color: #038203; color: white; }
.history-gmail-list {
    list-style: none;
    padding-left: 0;
    margin-top: 5px;
    margin-bottom: 0;
}
.history-gmail-list li {
    font-size: 0.9em;
    color: #555;
    padding: 2px 0;
}
.show-all-btn {
    color: #007bff;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.8em;
    display: block;
    margin-top: 5px;
}

/* ... aapka maujooda CSS code ... */

/* --- NEW CSS for hiding extra Gmails in history --- */
.hidden-gmail {
    display: none;
}

/* --- Task Page New Settings Styles --- */
.task-page-container {
    padding: 15px;
    margin-top: 10px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}
.task-section {
    margin-bottom: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
}
.task-section label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #038203;
}
.task-page-container input[type="number"], 
.task-page-container input[type="email"] {
    width: 95%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
}
#submitButtonTask {
    background-color: #4CAF50; /* Blue for submit */
    color: white;
    padding: 12px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 17px;
    width: 100%;
}
#submitButtonTask:hover {
    background-color: #0056b3;
}
/* History Styles */
.history-item-task {
    padding: 8px 0;
    border-bottom: 1px dashed #eee;
    display: flex;
    flex-wrap: wrap; /* To handle all data on small screen */
    justify-content: space-between;
    align-items: center;
    font-size: 0.9em;
}
.history-item-task:last-child {
    border-bottom: none;
}
.status-task {
    font-weight: bold;
    padding: 3px 6px;
    border-radius: 3px;
    font-size: 0.8em;
    min-width: 65px;
    text-align: center;
}
.status-task.Pending { background-color: #ffc107; color: #333; }
.status-task.Rejected { background-color: #dc3545; color: white; }
.status-task.Completed { background-color: #28a745; color: white; }
.hidden-gmail-task {
    display: none;
}
.toggle-btn-task {
    width: auto !important; 
    padding: 5px 10px !important; 
    margin-top: 5px !important; 
    background-color: #038203 !important;
    font-size: 0.85em !important;
}
.toggle-btn-task:hover {
    background-color: #026602 !important;
}
/* NEW STYLES FOR NOVA LOGO START */
.logo-container {
    text-align: center;
    margin-bottom: 25px; /* Logo aur title ke beech mein fasla (space) */
}

.logo-container img {
    max-width: 100px; /* Logo ka size control karne ke liye */
    height: auto;
    border-radius: 50%; /* Gol (circular) shape ke liye */
    border: 3px solid #fffff; /* Border ka rang (Green) */
    margin: 0 auto;
    display: block;
}
/* NEW STYLES FOR NOVA LOGO END */
/* --- Task History New Styles (Delete Menu) --- */

.history-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    /* Optional: Add some spacing around the items */
    gap: 10px; 
}

.history-gmail {
    flex: 1 1 40%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.history-datetime {
    flex: 0 0 auto;
    color: #555;
    font-size: 0.9em;
}

/* Status for 'Deleted' */
.status-task.deleted {
    background-color: #f8d7da; /* Light Red */
    color: #721c24; /* Dark Red */
    border: 1px solid #f5c6cb;
    padding: 3px 6px;
    border-radius: 3px;
    font-size: 0.8em;
    font-weight: bold;
    text-transform: capitalize;
    flex-shrink: 0;
}

/* 3-Dot Dropdown Menu Styling */
.dropdown-menu-task {
    position: relative;
    display: inline-block;
    flex-shrink: 0;
}

.menu-btn-task {
    background-color: transparent;
    color: #555;
    padding: 2px 8px;
    font-size: 1.2em;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    line-height: 1;
    margin-left: 5px; /* Spacing from status */
}

.menu-btn-task:hover {
    background-color: #eee;
}

.menu-content-task {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 120px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    right: 0; /* Align to the right of the button */
    border-radius: 4px;
    overflow: hidden;
}

.menu-content-task a {
    color: black;
    padding: 8px 12px;
    text-decoration: none;
    display: block;
    font-size: 0.9em;
}

.menu-content-task a:hover {
    background-color: #f1f1f1;
}

/* Show the dropdown menu */
.show {
    display: block;
}
/* --- Withdrawal History Styles --- */
.withdraw-history-section {
    margin-top: 25px;
}

.history-item {
    padding: 10px 0;
    border-left: 3px solid #ddd;
    padding-left: 10px;
}

.history-status {
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.75em;
    font-weight: bold;
    color: white;
    margin-left: 5px;
}

.status-success {
    background-color: #038203; /* Green */
}

.status-error {
    background-color: #cc0000; /* Red */
}

.status-info {
    background-color: #ff9900; /* Orange/Pending */
}

/* --- History List Styling --- */

.history-list {
    list-style: none;
    padding: 0;
    margin-top: 15px;
}

.history-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 10px;
    margin-bottom: 8px;
    background-color: #f9f9f9; /* Light background for items */
    border-radius: 6px;
    border-left: 5px solid #ccc; /* Default border */
    font-size: 14px;
}

.history-date {
    color: #666;
    flex: 1.5;
}

.history-amount {
    font-weight: bold;
    color: #333;
    flex: 1.5;
}

.history-method {
    color: #007bff;
    flex: 1;
    text-align: center;
}

.history-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 12px;
    text-align: right;
    flex: 1;
}

/* Status Color Badges */
.history-status.pending {
    background-color: #fff3cd; /* Yellowish */
    color: #856404;
    border: 1px solid #ffeeba;
}

.history-status.completed {
    background-color: #d4edda; /* Greenish */
    color: #155724;
    border: 1px solid #c3e6cb;
}

.history-status.rejected {
    background-color: #f8d7da; /* Reddish */
    color: #721c24;
    border: 1px solid #f5c6cb;
}

    </style>
</head>
<body>

    <div class="header" style="order: 1;">
        <div class="user-info hidden" id="userInfo">
            <div class="back-icon" id="backToDashboard" onclick="showPage('dashboard')" style="display: none; cursor: pointer; font-size: 1.2em; margin-right: 10px;">
                <i class="fa-solid fa-arrow-left"></i>
            </div>
            
            <div class="profile-photo" id="headerProfilePhoto" onclick="showPage('profile')"></div>
            <div class="username" id="displayUsername"></div>
            <div class="logout-icon" onclick="showAuth('login')"><i class="fa-solid fa-right-from-bracket"></i></div>
        </div>
        <div class="auth-header-text" id="authHeaderText">
             </div>
        <div class="app-title">NOVA</div>
        <div></div>
    </div>

    <div class="earning-section hidden" style="order: 1;" id="earningSection">
        <div class="earning-display">
            <h2 id="displayEarning">
                <i class="fas fa-eye" id="toggleEarning"></i>
                <span id="earningValue">0.00</span>
                <span id="currency-symbol">â‚±</span>
            </h2>
        </div>
        <div id="levelOption" onclick="handleQuickOptionClick('lv')">
            <i class="fas fa-layer-group"></i> LV.<span id="displayLevel">1</span>
        </div>
    </div>
    
    <div class="main-content hidden" id="dashboardContent">
        
        <div class="quick-options" id="quickOptionsBlock">
            
            <a class="quick-option" onclick="handleQuickOptionClick('task')">
                <i class="fas fa-list-check"></i>
                <span>Task</span>
            </a>
            <a class="quick-option" onclick="handleQuickOptionClick('withdraw')">
                <i class="fas fa-hand-holding-dollar"></i>
                <span>Withdraw</span>
            </a>
            <a class="quick-option" onclick="handleQuickOptionClick('profile')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
            
            <a class="quick-option" onclick="handleQuickOptionClick('rank')">
                <i class="fas fa-trophy"></i> 
                <span>Rank</span>
            </a>
            <a class="quick-option" onclick="handleQuickOptionClick('team')">
                <i class="fas fa-users"></i>
                <span>Team</span>
            </a>
            <a class="quick-option" onclick="handleQuickOptionClick('help')">
                <i class="fas fa-circle-question"></i>
                <span>Help</span>
            </a>
        </div>
        
        <div class="banner-container" id="bannerBlock">
            <div class="banner-carousel" id="bannerCarousel">
                <div class="banner-item active">
                    <img src="https://i.ibb.co/TDHYFS8R/20251005-171235.jpg" alt="Promotion Banner 1">
                </div>
                <div class="banner-item">
                    <img src="https://i.ibb.co/vrZ13sF/20251005-170037.jpg" alt="Promotion Banner 2">
                </div>
                <div class="banner-item">
                    <img src="https://i.ibb.co/MkHM8LHc/20251005-165324.jpg" alt="Promotion Banner 3">
                </div>
            </div>
            
            <div class="banner-nav">
                <button id="prevBanner"><i class="fas fa-chevron-left"></i></button>
                <button id="nextBanner"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
        
<div class="dashboard-page hidden" id="taskPage">
            
            <div class="task-page-container">
                <h3 style="color: #038203; border-bottom: 2px solid #eee; padding-bottom: 10px;">TASK</h3>
            
                <div class="task-section">
                    <label for="quantityInputTask">Quantity</label>
                    <input type="number" id="quantityInputTask" min="0" max="20" placeholder="Enter quantity (0-20)" oninput="generateGmailInputsTask()">
                </div>
            
                <div class="task-section">
                    <label>inter Gmail</label>
                    <div id="gmailInputsContainerTask">
                        </div>
                </div>
            
                <div class="task-section">
                    <button id="submitButtonTask" onclick="submitGmailsTask()"> SUMBIT</button>
                </div>
                
                <div class="task-section">
                    <label> Submission History</label>
                    <div id="historyListTask">
                        <p style="color:#777;">No history yet. Submit GMAILs to see history.</p>
                    </div>
                </div>
            </div>
            </div>
        
<div class="dashboard-page hidden" id="withdrawPage">
            <h3>Submit Withdrawal Request</h3>
            
            <div id="withdrawMessage" class="message hidden"></div>
            
            <form id="withdrawForm">
                
                <div class="form-group">
                    <label for="withdrawAmount">2. Amount in â‚± (Minimum â‚±1)</label>
                    <input type="number" id="withdrawAmount" placeholder="Enter amount" min="1" required>
                </div>
                
                <div class="form-group">
                    <label for="walletMethod">3. Select Payment Method</label>
                    <select id="walletMethod" required>
                        <option value="">Select one...</option>
                        <option value="EASYPAISA">EASYPAISA</option>
                        <option value="JAZZCASH">JAZZCASH</option>
                        <option value="U PAISA">U PAISA</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="walletName">5. Account Holder Name</label>
                    <input type="text" id="walletName" placeholder="Enter Account Holder Name" required>
                </div>
                
                <div class="form-group">
                    <label for="walletNumber">6. Account Number</label>
                    <input type="text" id="walletNumber" placeholder="Enter Account Number" required>
                </div>

                <button type="submit" class="btn-green">SUBMIT WITHDRAWAL</button>
            </form>

            <hr>
            <h4>Withdrawal History</h4>
            <div id="withdrawalHistoryList">
                <p>Loading withdrawal history...</p>
            </div>
            </div>

        <div class="dashboard-page hidden" id="profilePage">
            <h3>User Profile</h3>
            <form id="profileForm">
                
                <div class="profile-upload-area" style="text-align: center; margin-bottom: 20px; position: relative;">
                    <div class="profile-frame" id="profileFrameOverlay"></div>
                    
                    <div class="profile-upload-circle" id="profileImageCircle" style="width: 100px; height: 100px; border-radius: 50%; background-color: #ddd; display: inline-block; position: relative; overflow: hidden; border: 3px solid #038203; background-size: cover; background-position: center;">
                        </div>
                    
                    <i class="fa-solid fa-bars profile-menu-toggle-icon" onclick="toggleProfileMenu(event)"></i>
                    
                    <div id="profileOptionMenu" class="hidden profile-option-menu">
                        <div class="menu-item" onclick="showPhotoSelectionMenu(event)">
                            <i class="fa-solid fa-image"></i> **Photos**
                        </div>
                        <div class="menu-item" onclick="showFrameSelectionMenu(event)">
                            <i class="fa-solid fa-border-all"></i> **Frame**
                        </div>
                        <div class="menu-item disabled">
                            <i class="fa-solid fa-tag"></i> Title
                        </div>
                        <div class="menu-item disabled">
                            <i class="fa-solid fa-user-tag"></i> Name Tag
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="profileEmail">Email ID</label>
                    <input type="email" id="profileEmail" placeholder="user@example.com" value="" disabled> </div>
                
                <div class="form-group">
                    <label for="profileUsername">Username</label>
                    <input type="text" id="profileUsername" placeholder="Enter New Username (0/15)" maxlength="15" required>
                    <span id="usernameCharCount">0/15</span> </div>
                
                <div class="form-group">
                    <label for="profilePassword">New Password (Optional)</label>
                    <input type="password" id="profilePassword" placeholder="Enter New Password">
                </div>

                <div class="form-group">
                    <label for="profileConfirmPassword">Confirm New Password</label>
                    <input type="password" id="profileConfirmPassword" placeholder="Confirm New Password">
                </div>

                <button type="submit" class="btn-green">SAVE CHANGES</button>
                <div id="profileMessage" class="message hidden" style="margin-top: 15px;"></div>
            </form>
        </div>

        <div class="dashboard-page hidden" id="rankPage">
            <h3>My Rank</h3>
            <div class="rank-card">
                <h4>Rank Feature Coming Soon</h4>
                <p>The ranking system is currently under maintenance. Please check back later!</p>
            </div>
        </div>
        
<div class="dashboard-page hidden" id="teamPage">
    <h3>My Team & Referrals</h3>
    <div class="referral-box">
        <label>Your Referral Code</label>
        <div class="referral-code" id="referralCodeDisplay">Loading...</div>
    </div>

    <div style="display: flex; justify-content: space-around; text-align: center; margin-bottom: 20px;">
        <div class="team-stats-block" style="border-bottom: none; flex: 1;">
            <label style="color: #038203;">SUCCESS</label>
            <div id="successRefersCountDisplay" style="color: #038203; font-size: 1.8em; font-weight: bold;">0</div>
        </div>
        <div class="team-stats-block" style="border-bottom: none; flex: 1; border-left: 1px solid #eee; border-right: 1px solid #eee;">
            <label style="color: orange;">PENDING</label>
            <div id="pendingRefersCountDisplay" style="color: orange; font-size: 1.8em; font-weight: bold;">0</div>
        </div>
        <div class="team-stats-block" style="border-bottom: none; flex: 1;">
            <label style="color: #dc3545;">REJECTED</label>
            <div id="rejectedRefersCountDisplay" style="color: #dc3545; font-size: 1.8em; font-weight: bold;">0</div>
        </div>
    </div>
    
    <div class="team-stats-block" style="padding-top: 5px;">
        <label>TOTAL REFERRED MEMBERS</label>
        <div id="totalRefersCountDisplay">0</div>
    </div>
    <div class="referral-price"> PER REFER PRICE â‚±1 </div>

    <div class="referral-list-container" style="margin-top: 20px;">
        <h4><i class="fas fa-check-circle" style="color: #038203;"></i> ALL SUCCESS ACCOUNT USERS</h4>
        <div id="successReferralList">
            <div class="ref-member"><div class="member-detail">Loading successful referrals...</div></div>
        </div>
    </div>
    
    <div class="referral-list-container" style="margin-top: 20px;">
        <h4><i class="fas fa-hourglass-half" style="color: orange;"></i> ALL PENDING ACCOUNT USERS</h4>
        <div id="pendingReferralList">
            <div class="ref-member"><div class="member-detail">Loading pending referrals...</div></div>
        </div>
    </div>
    
    <div class="referral-list-container" style="margin-top: 20px;">
        <h4><i class="fas fa-times-circle" style="color: #dc3545;"></i> ALL REJECTED ACCOUNTS USERS</h4>
        <div id="rejectedReferralList">
            <div class="ref-member"><div class="member-detail">Loading rejected referrals...</div></div>
        </div>
    </div>
</div>

        <div class="dashboard-page hidden" id="helpPage">
            <h3>Contact & Support</h3>
            
            <div class="contact-info-block">
                <label>Contact Email</label>
                <div class="contact-value">jarwarrehman14@gmail.com</div>
            </div>
            
            <div class="contact-info-block">
                <label>WhatsApp Number</label>
                <div class="contact-value">+923093175931 (03093175931)</div>
            </div>

            <div class="contact-info-block" style="text-align: center; border: none;">
                <a href="https://wa.me/923093175931" target="_blank" class="btn-green" style="text-decoration: none; display: block;">
                    <i class="fa-brands fa-whatsapp"></i> JOIN WHATSAPP CHANNEL
                </a>
            </div>

            <h4>Frequently Asked Questions (FAQs)</h4>

            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    How can I earn on NOVA ERAN? <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    You can earn by completing the daily tasks available in the **Task** section and by referring new members to the platform using your unique referral code.
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    What is the minimum withdrawal amount? <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    The minimum withdrawal amount is â‚±1. Make sure your earnings balance meets this limit before submitting a request.
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    How long does a withdrawal take? <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    Withdrawals are typically processed within 24-48 hours. Please ensure your wallet details (Easypaisa/Jazzcash/U Paisa) are correctly saved in the **Withdraw Funds & Wallet Setup** section.
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    Where can I find my referral code? <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    Your unique referral code is located at the top of the **Team** section on the dashboard. Share it to earn referral bonuses!
                </div>
            </div>
            
        </div>
        
<div class="dashboard-page hidden" id="lvPage"> 
    <h3>Level Up Progress: LV.<span id="currentLevelDisplay">1</span></h3> 
    
    <p style="font-size: 1.2em; margin-bottom: 20px; font-weight: bold;">
        Current XP: 
        <strong style="color: #038203;"><span id="currentXPDisplay">0</span></strong>
    </p>
    
    <a class="btn-green" style="text-decoration: none; margin-bottom: 20px; display: block;" onclick="handleQuickOptionClick('missions')"> 
        <i class="fas fa-scroll"></i> GO TO MISSIONS 
    </a> 
    <div id="levelListContainer"> 
    </div> 
</div>
        
        <div class="dashboard-page hidden" id="missionsPage">
            <h3><i class="fas fa-scroll"></i> Daily Missions</h3>
            <div class="rank-card">
                <h4>Mission System Coming Soon!</h4>
                <p>The daily and weekly missions are under development. Check back later to earn more XP and â‚±!</p>
            </div>
        </div>
        
    </div>

    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            
            <form class="auth-form" id="loginForm">
    <div class="logo-container">
        <img src="https://i.ibb.co/DgHY9vKf/Gemini-Generated-Image-u1dtmhu1dtmhu1dt.png" alt="Nova Logo">
    </div>
    <h2>Login</h2>
    <div id="loginMessage" class="message hidden"></div>
    
    <input type="text" id="loginUsername" placeholder="Username / Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="submit">LOGIN</button>
    <a class="toggle-link" onclick="toggleForm('signup')">Don't have an account? Sign Up</a>
</form>

            <form class="auth-form hidden" id="signupForm">
                <h2>Sign Up</h2>
                <div id="signupMessage" class="message info">
                 </div>

                <input type="text" id="signupFullname" placeholder="Full Name" required>
                <input type="email" id="signupEmail" placeholder="Email Address" required>
                <input type="text" id="signupUsername" placeholder="Username" maxlength="15" required>
                <input type="text" id="signupReferralCode" placeholder="Referral Code">
                <input type="password" id="signupPassword" placeholder="Password" required>
                <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" required>
<div class="payment"> 
    <strong><i class="fas fa-exclamation-triangle"></i>Pay the fee!</strong> 
    <p style="font-weight: bold; color: #dc3545;">(Registration Fee: â‚±2 (200Rs PKR)</p> 
    <div class="payment-details"> 
        <p style="font-weight: bold;"><i class="fas fa-mobile-alt"></i> METHDO:</strong> <span style="color: #038203; font-weight: bold;">jazzcash</span></p> 
        <p><strong>acc Number:</strong> <span style="color: #038203; font-weight: bold;">03093175931</span></p> 
        <p><strong>acc. Name:</strong> <span style="color: #038203; font-weight: bold;">Ashiq Hussain</span></p> 
        
        <div class="form-group"> 
            <label for="paymentMethod">paid Method (Aapne kis tarah se fee bheji hai?)</label> 
            <select id="paymentMethod" required> 
                <option value="">Select paid method...</option>
                <option value="Sadapay">Sadapay</option>
                <option value="EASYPAISA">EASYPAISA</option>
                <option value="JAZZCASH">JAZZCASH</option>
                <option value="BANK TRANSFER">Bank Transfer</option>
                <option value="U PAISA">U PAISA</option>
            </select>
        </div>
        
        <div class="form-group"> 
            <label for="senderName">Sender Name (Fee Bhejney Waley Ka Naam)</label> 
            <input type="text" id="senderName" placeholder="name" required> 
        </div>
        
        <div class="form-group"> 
            <label for="trxId">TRX ID / Reference Number</label> 
            <input type="text" id="trxId" placeholder="Transaction ID (e.g., TPC-12345678)" required> 
        </div>
        
        <div class="form-group"> 
            <label for="senderNumber">Sender Number (Fee Bhejney Wala Number)</label> 
            <input type="text" id="senderNumber" placeholder="e.g., 03xxxxxxxxx" required> 
        </div>
        
        </div>
</div>
<button type="submit" class="btn-green">SIGN UP</button>
<a class="toggle-link" onclick="toggleForm('login')">Already have an account? Login</a>
        </div>
    </div>
    
    <div class="message-section hidden" style="order: 3;" id="messageBlock">
        <div class="big-message">BEST OF LUCK</div>
    </div>

    <div id="banOverlay" class="hidden">
        <div class="ban-box">
            <h2>ACCOUNT BANNED</h2>
            
            <div class="ban-info">
                <p><strong>USERNAME:</strong> <span id="banUsername"></span></p>
                <p><strong>GMAIL:</strong> <span id="banEmail"></span></p>
                <p style="margin-top: 20px; font-weight: bold; color: #dc3545; font-size: 1.1em;">
                    Your account has been banned due to security violation. Please Use official WEBSITE
                </p>
            </div>
            
            <a href="https://wa.me/923093175931" target="_blank" class="btn-green" style="display: block; margin-top: 20px; background-color: #25D366;">
                <i class="fa-brands fa-whatsapp"></i> Contact us
            </a>
            
            <button class="btn-secondary" onclick="showAuth('login')">
                Login to another account
            </button>
            
            <p style="font-size: 0.8em; color: #777; margin-top: 15px;">Thank you</p>
        </div>
    </div>
    
    <div id="photoSelectionOverlay" class="hidden">
        <div class="photo-box">
            <h3><i class="fa-solid fa-image"></i> Select Profile Photo <i class="fa-solid fa-image"></i></h3>
            <div id="currentSelectedPhotoDisplay" class="photo-display-circle"></div>
            
            <div class="photo-grid-nav">
                <button id="navOwned" class="active" onclick="setPhotoFilter('owned', this)">OWNED</button>
                <button id="navAll" onclick="setPhotoFilter('all', this)">ALL</button>
            </div>
            
            <div id="photoSelectionMessage" class="message hidden"></div>
            
            <div class="photo-grid" id="photoGrid">
                </div>
            
            <button class="btn-green" id="savePhotoBtn">
                <i class="fa-solid fa-check"></i> SAVE PHOTO
            </button>
            <button class="profile-option-button" onclick="hidePhotoSelection()" style="margin-top: 10px;">
                <i class="fa-solid fa-xmark"></i> CANCEL
            </button>
        </div>
    </div>

    <div id="frameSelectionOverlay" class="hidden">
        <div class="frame-box">
            <h3><i class="fa-solid fa-border-all"></i> Select Profile Frame <i class="fa-solid fa-border-all"></i></h3>
            <div id="currentSelectedFrameDisplay" class="frame-display-circle"></div>
            
            <div class="frame-grid-nav">
                <button id="navFrameOwned" class="active" onclick="setFrameFilter('owned', this)">OWNED</button>
                <button id="navFrameAll" onclick="setFrameFilter('all', this)">ALL</button>
            </div>
            
            <div id="frameSelectionMessage" class="message hidden"></div>
            
            <div class="frame-grid" id="frameGrid">
                </div>
            
            <button class="btn-green" id="saveFrameBtn">
                <i class="fa-solid fa-check"></i> SAVE FRAME
            </button>
            <button class="profile-option-button" onclick="hideFrameSelection()" style="margin-top: 10px;">
                <i class="fa-solid fa-xmark"></i> CANCEL
            </button>
        </div>
    </div>
    
    <div class="footer-contact" style="order: 4;">
        <p>Â©2024 NOVA (Formerly AxR ERAN). All rights reserved.</p>
        <div style="margin-top: 10px;">
            <a href="https://wa.me/923093175931" class="contact-link" target="_blank">
                <i class="fa-brands fa-whatsapp"></i> WA CONTACT
            </a>
            <a href="https://chat.whatsapp.com/FpmihMMYElNKjIb84UQqXa?mode=ems_copy_t" class="contact-link" target="_blank">
                <i class="fa-brands fa-whatsapp-square"></i> WA GROUP
            </a>
            <a href="https://whatsapp.com/channel/0029VbC4zNw6LwHcEFN0Yz2n" class="contact-link" target="_blank">
                <i class="fa-brands fa-whatsapp"></i> WA CHANNEL
            </a>
        </div>
    </div>
    
    <div id="frameSelectionOverlay" class="hidden">
        <div class="frame-box">
            <h3><i class="fa-solid fa-border-all"></i> Select Profile Frame <i class="fa-solid fa-border-all"></i></h3>
            <div id="currentSelectedFrameDisplay" class="frame-display-circle"></div>
            
            <div class="frame-grid-nav">
                <button id="navFrameOwned" class="active" onclick="setFrameFilter('owned', this)">OWNED</button>
                <button id="navFrameAll" onclick="setFrameFilter('all', this)">ALL</button>
            </div>
            
            <div id="frameSelectionMessage" class="message hidden"></div>
            
            <div class="frame-grid" id="frameGrid">
                
                <div class="frame-item selected frame-green-line" data-frame-id="default" data-is-owned="true">
                    <i class="fas fa-check" style="color: white; background: #038203; border-radius: 50%; padding: 5px; font-size: 0.8em;"></i>
                </div>
                
                <div class="frame-item frame-blush" data-frame-id="blush" data-is-owned="true">
                    <i class="fa-solid fa-heart" style="color: #ff9a9e; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item frame-gold" data-frame-id="gold" data-is-owned="true">
                    <i class="fa-solid fa-star" style="color: #ffd700; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item frame-diamond" data-frame-id="diamond" data-is-owned="true">
                    <i class="fa-solid fa-gem" style="color: #b9f2ff; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item frame-animated" data-frame-id="animated" data-is-owned="true">
                    <i class="fa-solid fa-bolt" style="color: white; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item" data-frame-id="silver" data-is-owned="true" style="border: 3px solid #c0c0c0 !important; box-shadow: 0 0 10px #c0c0c0;">
                    <i class="fa-solid fa-crown" style="color: #c0c0c0; font-size: 1.5em;"></i>
                </div>

                <div class="frame-item" data-frame-id="bronze" data-is-owned="true" style="border: 3px solid #cd7f32 !important;">
                    <i class="fa-solid fa-medal" style="color: #cd7f32; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item locked frame-gold" data-frame-id="locked-gold" data-is-owned="false">
                    </div>
                
                <div class="frame-item locked frame-animated" data-frame-id="locked-animated" data-is-owned="false">
                    </div>
                
                <div class="frame-item" data-frame-id="blue" data-is-owned="true" style="border: 3px solid #007bff !important;">
                    <i class="fa-solid fa-water" style="color: #007bff; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item" data-frame-id="red" data-is-owned="true" style="border: 3px solid #dc3545 !important;">
                    <i class="fa-solid fa-fire" style="color: #dc3545; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item locked" data-frame-id="simple-locked" data-is-owned="false" style="border: 3px solid #888 !important;">
                    </div>
                
                <div class="frame-item locked" data-frame-id="vip-frame" data-is-owned="false" style="border: 4px dashed purple !important; box-shadow: 0 0 10px purple;">
                    <i class="fa-solid fa-key" style="color: purple; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item locked" data-frame-id="event-frame" data-is-owned="false" style="border: 3px solid orange !important;">
                    <i class="fa-solid fa-calendar-alt" style="color: orange; font-size: 1.5em;"></i>
                </div>
                
                <div class="frame-item" data-frame-id="last-frame" data-is-owned="true" style="border: 3px solid #ff69b4 !important;">
                    <i class="fa-solid fa-gift" style="color: #ff69b4; font-size: 1.5em;"></i>
                </div>
                
            </div>
            <button class="btn-green" id="saveFrameBtn">
                <i class="fa-solid fa-check"></i> SAVE FRAME
            </button>
            <button class="profile-option-button" onclick="hideFrameSelection()" style="margin-top: 10px;">
                <i class="fa-solid fa-xmark"></i> CANCEL
            </button>
        </div>
    </div>

<script>
   // --- JSONBIN CONFIGURATION (UPDATED) ---
    const USER_BIN_ID = '68f86095d0ea881f40b2611c'; 
    // New Bin for saving ALL task submissions with 'pending' status
    const TASK_BIN_ID = '68f8641343b1c97be9776e30 '; 
    // ðŸ’¸ NEW Bin for saving Withdrawal Requests
    const WITHDRAWAL_BIN_ID = '691332b2d0ea881f40e1c32f'; 
    
    // Your Master API Key (used for all bins)
    const API_KEY = '$2a$10$qSi1CUosLRHgojpIR7.tJ.1zCsW.v.dv88dCL0dDGuuTut31zb0ve'; 
    
    // Other existing constants
    const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${WITHDRAWAL_BIN_ID}/latest`;
    const BIN_URL = `https://api.jsonbin.io/v3/b/${USER_BIN_ID}`;
    const TASK_BIN_URL = `https://api.jsonbin.io/v3/b/${TASK_BIN_ID}`;
    
    // ðŸ’¸ NEW URL for Withdrawal Requests - uses the new ID
    const WITHDRAWAL_BIN_URL = `https://api.jsonbin.io/v3/b/${WITHDRAWAL_BIN_ID}`;
    const DEFAULT_PROFILE_PIC = 'https://i.ibb.co/jPj05H3n/5053818a843f8cce4be6b84c801bea43.jpg';
    
    // 1ï¸âƒ£. MODIFIED: Profile Photo Array with Lock Status
    const PROFILE_PHOTO_LINKS = [
        { url: DEFAULT_PROFILE_PIC, isLocked: false }, // Default photo, unlocked
        { url: 'https://i.ibb.co/8nrY7NfX/03ebd625cc0b9d636256ecc44c0ea324.jpg', isLocked: false }, // Unlocked
        { url: 'https://i.ibb.co/fGkpRd81/5665e34f05ce5e1270b81ee0f64922f3.jpg', isLocked: true }, // Locked (3rd photo)
        { url: 'https://i.ibb.co/KjZ4D0KH/2506c909c706c6fcbaaf686aafc5032e.jpg', isLocked: true }, // Locked (4th photo)
        { url: 'https://i.ibb.co/b5rqccCX/875b4fb82c44a038466807b0dcf884cc.jpg', isLocked: true }, // Locked (5th photo)
        { url: 'https://i.ibb.co/2YmM3mxp/69781905dd57ba144ab71ca4271ab294.jpg', isLocked: false } // Unlocked (6th photo)
    ];

    // 4. NEW: Profile Frame Array with Lock Status (6 frames + 1 default)
    const PROFILE_FRAME_LINKS = [
        { url: '', name: 'No Frame', isLocked: false }, // Default: Empty string for no frame
        { url: 'https://i.ibb.co/YyY1q4d/Frame-01-Gold.png', name: 'Gold Ring', isLocked: false }, 
        { url: 'https://i.ibb.co/8Prw3yW/Frame-02-Blue.png', name: 'Blue Glow', isLocked: true }, 
        { url: 'https://i.ibb.co/jL2L65x/Frame-03-Red.png', name: 'Fire Aura', isLocked: true }, 
        { url: 'https://i.ibb.co/jWn2R4f/Frame-04-Green.png', name: 'Neon Green', isLocked: false }, 
        { url: 'https://i.ibb.co/8xT1sJm/Frame-05-Diamond.png', name: 'Diamond Edge', isLocked: true }, 
        { url: 'https://i.ibb.co/2v2k26J/Frame-06-VIP.png', name: 'VIP Badge', isLocked: false } 
    ];


// --- Level XP Configuration (NEW) ---
// Yahaan XP aur uske corresponding level ke thresholds define kiye gaye hain.
const LEVEL_THRESHOLDS = [
    { level: 1, xp: 0 },
    { level: 2, xp: 100 }, // User Request: LV 2 at 120 XP
    { level: 3, xp: 200 }, // User Request: LV 3 at 200 XP
    { level: 4, xp: 300 }, // Example: LV 4 at 350 XP
    { level: 5, xp: 400 }, // Example: LV 5 at 450 XP
    { level: 6, xp: 500 },
    { level: 7, xp: 600 }, // User Example: LV 6 at 500 XP
    { level: 8, xp: 700 },
    { level: 9, xp: 800 },
    { level: 10, xp: 900 },  
{ level: 11, xp: 1010 },
{ level: 12, xp: 1120 },
{ level: 13, xp: 1230 },
{ level: 14, xp: 1340 },
{ level: 15, xp: 1450 },
{ level: 16, xp: 1560 },
{ level: 17, xp: 1670 },
{ level: 18, xp: 1780 },
{ level: 19, xp: 1890 },
{ level: 20, xp: 2000 },
{ level: 21, xp: 2110 },
{ level: 22, xp: 2220 },
{ level: 23, xp: 2330 },
{ level: 24, xp: 2440 },
{ level: 25, xp: 2550 },
{ level: 26, xp: 2660 },
{ level: 27, xp: 2770 },
{ level: 28, xp: 2880 },
{ level: 29, xp: 2990 },
{ level: 30, xp: 3100 },
{ level: 31, xp: 3210 },
{ level: 32, xp: 3320 },
{ level: 33, xp: 3430 },
{ level: 34, xp: 3540 },
{ level: 35, xp: 3650 },
{ level: 36, xp: 3760 },
{ level: 37, xp: 3870 },
{ level: 38, xp: 3980 },
{ level: 39, xp: 4090 },
{ level: 40, xp: 4200 },
{ level: 41, xp: 4310 },
{ level: 42, xp: 4420 },
{ level: 43, xp: 4530 },
{ level: 44, xp: 4640 },
{ level: 45, xp: 4750 },
{ level: 46, xp: 4860 },
{ level: 47, xp: 4970 },
{ level: 48, xp: 5080 },
{ level: 49, xp: 5190 },
{ level: 50, xp: 5300 },
{ level: 51, xp: 5410 },
{ level: 52, xp: 5520 },
{ level: 53, xp: 5630 },
{ level: 54, xp: 5740 },
{ level: 55, xp: 5850 },
{ level: 56, xp: 5960 },
{ level: 57, xp: 6070 },
{ level: 58, xp: 6180 },
{ level: 59, xp: 6290 },
{ level: 60, xp: 6400 },
{ level: 61, xp: 6510 },
{ level: 62, xp: 6620 },
{ level: 63, xp: 6730 },
{ level: 64, xp: 6840 },
{ level: 65, xp: 6950 },
{ level: 66, xp: 7060 },
{ level: 67, xp: 7170 },
{ level: 68, xp: 7280 },
{ level: 69, xp: 7390 },
{ level: 70, xp: 7500 },
{ level: 71, xp: 7610 },
{ level: 72, xp: 7720 },
{ level: 73, xp: 7830 },
{ level: 74, xp: 7940 },
{ level: 75, xp: 8050 },
{ level: 76, xp: 8160 },
{ level: 77, xp: 8270 },
{ level: 78, xp: 8380 },
{ level: 79, xp: 8490 },
{ level: 80, xp: 8600 },
{ level: 81, xp: 8710 },
{ level: 82, xp: 8820 },
{ level: 83, xp: 8930 },
{ level: 84, xp: 9040 },
{ level: 85, xp: 9150 },
{ level: 86, xp: 9260 },
{ level: 87, xp: 9370 },
{ level: 88, xp: 9480 },
{ level: 89, xp: 9590 },
{ level: 90, xp: 9700 },
{ level: 91, xp: 9810 },
{ level: 92, xp: 9920 },
{ level: 93, xp: 10030 },
{ level: 94, xp: 10140 },
{ level: 95, xp: 10250 },
{ level: 96, xp: 10360 },
{ level: 97, xp: 10470 },
{ level: 98, xp: 10580 },
{ level: 99, xp: 10690 },
{ level: 100, xp: 10800 },
    // Zaroorat ke hisaab se yahaan aur levels add kar sakte hain.
];

/** Calculates the max possible level based on current XP. */
function calculateNewLevel(currentXP) {
    let newLevel = 1;
    // Iterates through thresholds to find the highest level achieved
    for (const threshold of LEVEL_THRESHOLDS) {
        if (currentXP >= threshold.xp) {
            newLevel = threshold.level;
        }
    }
    return newLevel;
}

/** Checks user's XP, updates the level locally, and saves it to JSON Bin if a level up occurred. */
async function checkForLevelUp(user) {
    const currentXP = user.xp || 0;
    const currentLevel = user.level || 1;
    const calculatedLevel = calculateNewLevel(currentXP);

    if (calculatedLevel > currentLevel) {
        console.log(`LEVEL UP! From LV ${currentLevel} to LV ${calculatedLevel}`);
        
        // 1. Update the user object locally
        user.level = calculatedLevel;
        
        // 2. Find and update the user in the global allAccounts array
        const userIndex = allAccounts.findIndex(acc => acc.username === user.username);
        if (userIndex !== -1) {
            allAccounts[userIndex].level = calculatedLevel;
            
            // 3. Update the JSON Bin (LV will be saved)
            const updateResult = await updateAccountsOnBin(allAccounts);

            if (updateResult.success) {
                // Return the updated user object which will be saved to localStorage
                return user; 
            } else {
                console.error("Failed to update level on JSON Bin. Using local update only.");
                return user;
            }
        }
    }
    // Return the user object (either updated or original)
    return user;
}

// --- Global State ---
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
    let allAccounts = []; 
    let bannerInterval; // For automatic banner rotation
    let tempSelectedPhotoUrl = ''; // To hold the URL selected in the photo modal
    let currentPhotoFilter = 'owned'; // State for photo selection filter
    let tempSelectedFrameUrl = ''; // 4. NEW: To hold the URL selected in the frame modal
    let currentFrameFilter = 'owned'; // 4. NEW: State for frame selection filter


    /** Generates a random alphanumeric code (e.g., ISBTSI1KB1) */
    function generateRandomCode(length = 10) { 
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let result = '';
        for (let i = 0; i < length; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }
    
    // Format earnings (1000 -> 1.00K)
    function formatEarning(amount) {
        amount = parseFloat(amount || 0);
        if (amount >= 1000) {
            return (amount / 1000).toFixed(2) + 'K';
        }
        return amount.toFixed(2);
    }
    
    // --- Utility Functions ---

    /** Fetches the full list of accounts from JSON Bin. */
    async function fetchAccounts() {
        try {
            const response = await fetch(BIN_URL, {
                method: 'GET',
                headers: {
                    'X-Master-Key': API_KEY, 
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            
            if (data.record && data.record.accounts) {
                 // ... (inside fetchAccounts function)

                // Ensure every account has required fields (XP removed here)
                allAccounts = data.record.accounts.map(account => ({
                    ...account,
                    status: account.status || 'UNBANNED',
                    earning: account.earning || 0,
                    level: account.level || 1,
                    // âŒ XP property removed
                    profileFrameUrl: account.profileFrameUrl || '',
                    account_permission: account.account_permission || 'Success' 
                }));
                return allAccounts; 
                // ...
            } else {
                console.error('Error: JSON structure is incorrect.');
                return null;
            }
        } catch (error) {
            console.error('Error fetching accounts:', error);
            return null;
        }
    }

    /** Updates the entire accounts array back to JSON Bin. (For Signup and Profile Update) */
    async function updateAccountsOnBin(newAccounts) {
        try {
            const response = await fetch(BIN_URL, {
                method: 'PUT',
                headers: {
                    'X-Master-Key': API_KEY,
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*' 
                },
                body: JSON.stringify({ accounts: newAccounts })
            });

            if (!response.ok) {
                console.error('JSONBin PUT Failed. Status:', response.status);
                return { success: false, message: `Server Error: HTTP ${response.status}` };
            }

            const data = await response.json();
            console.log('JSON Bin Update Success:', data);
            return { success: true, message: 'Data updated successfully.' };

        } catch (error) {
            console.error('Error updating accounts on bin:', error);
            return { success: false, message: 'Network Error during save operation.' };
        }
    }
    
    /** Sets the profile picture and frame in the header. */
    function updateHeaderProfilePic() {
        const headerPhoto = document.getElementById('headerProfilePhoto');
        // Use user's saved URL if available, otherwise use default
        const imageUrl = (currentUser && currentUser.profilePicUrl && currentUser.profilePicUrl !== 'null') 
                         ? currentUser.profilePicUrl 
                         : DEFAULT_PROFILE_PIC; 
        headerPhoto.style.backgroundImage = `url('${imageUrl}')`;
        
        // Note: Header photo cannot display frame easily without complex structure, 
        // so we only update the main photo here. The frame is only on the Profile page modal.
    }

    // --- Ban Screen Logic ---
    function showBanScreen(user) {
        document.getElementById('banOverlay').classList.remove('hidden');
        document.getElementById('banUsername').textContent = user.username || 'N/A';
        document.getElementById('banEmail').textContent = user.email || 'N/A';
        
        // Hide all main content and auth forms, making sure only the overlay is visible
        dashboardContent.classList.add('hidden');
        earningSection.classList.add('hidden');
        userInfo.classList.add('hidden');
        authContainer.classList.add('hidden');
        document.getElementById('messageBlock').classList.add('hidden'); 
    }

    // Function to hide Ban Screen
    function hideBanScreen() {
        document.getElementById('banOverlay').classList.add('hidden');
    }
    
    /** Checks the current user's status against the latest data. */
    async function checkUserStatus() {
        if (!currentUser) return false;

        const accounts = await fetchAccounts();
        if (!accounts) {
            console.error("Failed to fetch accounts during status check.");
            // Allow user to continue if fetching fails (better than locking them out)
            return false;
        }

        const latestUser = accounts.find(acc => acc.username === currentUser.username);
        
        if (latestUser && latestUser.status === 'BANNED') {
            // Update the local currentUser state and force ban screen
            currentUser = latestUser;
            localStorage.setItem('currentUser', JSON.stringify(latestUser));
            showBanScreen(currentUser);
            return true;
        } else if (latestUser && latestUser.status === 'UNBANNED' && currentUser.status === 'BANNED') {
            // If user was banned but is now unbanned, update state and show dashboard
            currentUser = latestUser;
            localStorage.setItem('currentUser', JSON.stringify(latestUser));
            showDashboard(latestUser); // Pass latestUser for fresh data
            return false;
        }
        
        // If not banned, simply update the local data (e.g., earnings, level, frame)
        if (latestUser) {
             currentUser = latestUser;
             localStorage.setItem('currentUser', JSON.stringify(latestUser));
             earningValue.textContent = formatEarning(latestUser.earning);
             document.getElementById('displayLevel').textContent = latestUser.level; // Update LV in header
        }

        return false;
    }

    // --- UI Elements ---
    const dashboardContent = document.getElementById('dashboardContent');
    const authContainer = document.getElementById('authContainer');
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const userInfo = document.getElementById('userInfo');
    const earningSection = document.getElementById('earningSection');
    const displayUsername = document.getElementById('displayUsername');
    const earningValue = document.getElementById('earningValue');
    const loginMessage = document.getElementById('loginMessage');
    const signupMessage = document.getElementById('signupMessage');
    const backButton = document.getElementById('backToDashboard');
    const usernameInput = document.getElementById('profileUsername');
    
    // Banner elements
    const bannerItems = document.querySelectorAll('.banner-item');
    const prevBannerButton = document.getElementById('prevBanner');
    const nextBannerButton = document.getElementById('nextBanner');
    let currentBannerIndex = 0;

    // All Dashboard Page Elements
    const pages = [
        document.getElementById('taskPage'),
        document.getElementById('withdrawPage'),
        document.getElementById('profilePage'),
        document.getElementById('rankPage'),
        document.getElementById('teamPage'),
        document.getElementById('helpPage'),
        document.getElementById('lvPage'), 
        document.getElementById('missionsPage'), 
    ];
    
    const dashboardBlocks = [
        document.getElementById('quickOptionsBlock'),
        document.getElementById('bannerBlock'),
    ];
    
    // --- Banner Carousel Logic (New) ---
    
    function showBanner(index) {
        bannerItems.forEach((item, i) => {
            item.classList.remove('active');
            if (i === index) {
                item.classList.add('active');
            }
        });
        currentBannerIndex = index;
    }

    function nextBanner() {
        let newIndex = (currentBannerIndex + 1) % bannerItems.length;
        showBanner(newIndex);
    }

    function prevBanner() {
        let newIndex = (currentBannerIndex - 1 + bannerItems.length) % bannerItems.length;
        showBanner(newIndex);
    }
    
    function startBannerInterval() {
        if (bannerInterval) clearInterval(bannerInterval);
        bannerInterval = setInterval(nextBanner, 10000); // 10 seconds auto-change
    }
    
    // Manual navigation resets the timer
    prevBannerButton.addEventListener('click', () => {
        prevBanner();
        startBannerInterval(); // Reset interval
    });

    nextBannerButton.addEventListener('click', () => {
        nextBanner();
        startBannerInterval(); // Reset interval
    });
    
    // Start the interval when the dashboard is shown
    startBannerInterval(); 
    // --- End Banner Carousel Logic ---


    // --- Main UI Logic ---

// Function to show a specific page (or the main dashboard)
    function showPage(pageId) { // <-- AB YAHAN 'async' HATA DIYA GAYA HAI
        
        // ðŸš¨ Real-time Ban Check (non-blocking call)
        // Check ko background mein chalao, lekin navigation ko mat roko.
        checkUserStatus(); // <-- 'await' aur 'if' statement hata diya gaya hai.
        
        // Hide all floating menus/overlays (including the new frame one)
        document.getElementById('photoSelectionOverlay').classList.add('hidden');
        document.getElementById('frameSelectionOverlay').classList.add('hidden'); 
        document.getElementById('profileOptionMenu').classList.add('hidden');

        // Hide all dashboard blocks and all new pages
        [...dashboardBlocks, ...pages].forEach(el => el.classList.add('hidden'));

        // --- FIXED LOGIC (Jo hum ne pichle fix mein banaya tha) ---
        if (pageId === 'dashboard') {
            dashboardBlocks.forEach(el => el.classList.remove('hidden'));
            backButton.style.display = 'none';
        } else if (pageId === 'task') {
            document.getElementById('taskPage').classList.remove('hidden'); 
            backButton.style.display = 'flex'; // Last fix se 'flex'
        } else if (pageId === 'withdraw') {
            document.getElementById('withdrawPage').classList.remove('hidden');
            backButton.style.display = 'flex';
        } else if (pageId === 'profile') {
            document.getElementById('profilePage').classList.remove('hidden');
            populateProfilePage();
            backButton.style.display = 'flex';
        } else if (pageId === 'rank') { 
            document.getElementById('rankPage').classList.remove('hidden');
            backButton.style.display = 'flex';
        } else if (pageId === 'team') {
            document.getElementById('teamPage').classList.remove('hidden');
            renderTeamPage();
            backButton.style.display = 'flex';
        } else if (pageId === 'help') {
            document.getElementById('helpPage').classList.remove('hidden');
            backButton.style.display = 'flex';
        } else if (pageId === 'lv') { 
            document.getElementById('lvPage').classList.remove('hidden');
            populateLevelPage(); 
            backButton.style.display = 'flex';
        } else if (pageId === 'missions') { 
            document.getElementById('missionsPage').classList.remove('hidden');
            backButton.style.display = 'flex';
        }
    }
    
    // ðŸš¨ New handler for quick options (to force status check)
    async function handleQuickOptionClick(pageId) {
        if (await checkUserStatus()) {
            return;
        }
        showPage(pageId);
    }
    window.handleQuickOptionClick = handleQuickOptionClick; // Make globally accessible

// Function to show/hide sections (Login -> Dashboard) 
async function showDashboard(user) { // FUNCTION KO 'async' BANAYEIN
    // Ensure user object has new fields
    let tempUser = {
        ...user,
        level: user.level || 1, 
        xp: user.xp || 0,
        profileFrameUrl: user.profileFrameUrl || '' 
    }; 
    
    // ðŸš¨ NEW LOGIC: Check for Level Up and update JSON if needed
    const updatedUser = await checkForLevelUp(tempUser); // Level check run karein aur JSON update karein
    currentUser = updatedUser; // Global state ko updated user se set karein

    localStorage.setItem('currentUser', JSON.stringify(currentUser)); 
    
    // BANNED Status Check
    if (currentUser.status === 'BANNED') {
        showBanScreen(currentUser);
        return; 
    }
    
    // If not banned, show dashboard normally
    hideBanScreen();
    dashboardContent.classList.remove('hidden');
    earningSection.classList.remove('hidden');
    userInfo.classList.remove('hidden');
    authContainer.classList.add('hidden');
    document.getElementById('messageBlock').classList.remove('hidden'); 
    
    displayUsername.textContent = currentUser.username;
    earningValue.textContent = formatEarning(currentUser.earning);
    document.getElementById('displayLevel').textContent = currentUser.level; // Set updated LV in header
    
    updateHeaderProfilePic(); 
    startBannerInterval(); // Start banner rotation
    
    showPage('dashboard'); 
}
    // Function to show/hide sections (Dashboard -> Login)
    function showAuth(formType = 'login') {
        hideBanScreen(); 
        document.getElementById('photoSelectionOverlay').classList.add('hidden'); 
        document.getElementById('frameSelectionOverlay').classList.add('hidden'); // NEW: Hide frame selection
        document.getElementById('profileOptionMenu').classList.add('hidden'); 
        dashboardContent.classList.add('hidden');
        earningSection.classList.add('hidden');
        userInfo.classList.add('hidden');
        authContainer.classList.remove('hidden');
        document.getElementById('messageBlock').classList.add('hidden'); 
        
        toggleForm(formType);
        localStorage.removeItem('currentUser'); 
        currentUser = null; 
        if (bannerInterval) clearInterval(bannerInterval); // Stop banner rotation
    }
    window.showAuth = showAuth; // Make globally accessible for the new ban button

    // Function to switch between Login and Signup forms
    function toggleForm(formType) {
        loginMessage.classList.add('hidden'); 
        signupMessage.classList.add('hidden');

        if (formType === 'login') {
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            loginForm.reset();
        } else if (formType === 'signup') {
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
            signupForm.reset();
        }
    }
    
    // Eye Icon Toggle Handler
    document.getElementById('toggleEarning').addEventListener('click', function() {
        const icon = this;
        
        if (earningValue.style.filter === 'blur(5px)') {
            // Show earnings
            earningValue.style.filter = 'none';
            icon.classList.replace('fa-eye-slash', 'fa-eye');
        } else {
            // Hide earnings
            earningValue.style.filter = 'blur(5px)';
            icon.classList.replace('fa-eye', 'fa-eye-slash');
        }
    });

// --- Login Form Submission Handler ---
loginForm.addEventListener('submit', async function(event) {
    event.preventDefault();

    const usernameInput = document.getElementById('loginUsername').value.trim();
    const passwordInput = document.getElementById('loginPassword').value;

    if (!usernameInput || !passwordInput) {
        loginMessage.textContent = 'Please enter both username and password.';
        loginMessage.classList.remove('hidden', 'info');
        loginMessage.classList.add('error');
        return;
    }
    
    // Set loading message
    loginMessage.textContent = 'Verifying your account';
    loginMessage.classList.remove('hidden', 'success', 'error');
    loginMessage.classList.add('info');

    const accounts = await fetchAccounts();
    
    if (accounts === null) {
        loginMessage.textContent = ' check your internet connection ';
        loginMessage.classList.add('error');
        loginMessage.classList.remove('info');
        return; 
    }
    
    // Search for the user
    const user = accounts.find(acc => 
        (acc.username === usernameInput || acc.email === usernameInput) && acc.password === passwordInput
    );

    if (user) {
        // --- NEW ACCOUNT_PERMISSIONS CHECK ---
        const permission = user.account_permission || 'Success'; // Default to 'Success' if field is missing

        if (permission === 'Pending') {
            loginMessage.textContent = 'Please wait for approval'; // 1. Pending
            loginMessage.classList.add('error'); // Use error style for visibility
            loginMessage.classList.remove('info', 'success');
            return;
        } else if (permission === 'Rejected') {
            loginMessage.textContent = 'Sorry, you are rejected'; // 3. Rejected
            loginMessage.classList.add('error');
            loginMessage.classList.remove('info', 'success');
            return;
        } 
        // If permission is 'Success' (or any other value not 'Pending'/'Rejected'), proceed. (2. Success)
        
        loginMessage.textContent = 'Login Successful!';
        loginMessage.classList.add('success');
        loginMessage.classList.remove('info', 'error');
        
        setTimeout(() => {
            
            // â­ Ø¢Ù¾ Ú©ÛŒ Ù…Ø·Ù„ÙˆØ¨Û Local Storage Ú©ÛŒ Ù„Ø§Ø¦Ù† â­
            // ÛŒÛ Ù„Ø§Ø¦Ù† ØµØ§Ø±Ù Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ø¨Ø±Ø§Ø¤Ø²Ø± Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸ Ú©Ø±ØªÛŒ ÛÛ’ ØªØ§Ú©Û ÙˆÛ Ø®ÙˆØ¯ Ø¨Ø®ÙˆØ¯ Ù„Ø§Ú¯ Ø§Ù† ÛÙˆ Ø³Ú©Û’
            localStorage.setItem("currentUser", JSON.stringify(user)); 
            
            // showDashboard now handles BANNED status and new fields (level/frame) automatically
            showDashboard(user); 
            loginForm.reset();
        }, 500);

    } else {
        // Standard invalid login message if user is not found or password incorrect
        loginMessage.textContent = 'Invalid Username or Password!';
        localStorage.removeItem("currentUser"); // Ø§Ú¯Ø± Ù„Ø§Ú¯ Ø§Ù† ÙÛŒÙ„ ÛÙˆ ØªÙˆ Ù…Ø­ÙÙˆØ¸ Ø´Ø¯Û Ø³ÛŒØ´Ù† ÛÙ¹Ø§ Ø¯ÛŒÚº
        loginMessage.classList.remove('success', 'info');
        loginMessage.classList.add('error');
        loginMessage.classList.remove('hidden');
    }
});
    
// --- Signup Form Submission Handler ---
    signupForm.addEventListener('submit', async function(event) {
        event.preventDefault();
        
        // --- PAYMENT FIELDS KI VALUES LENA ---
        const paymentMethod = document.getElementById('paymentMethod').value.trim();
        const senderName = document.getElementById('senderName').value.trim();
        const trxId = document.getElementById('trxId').value.trim();
        const senderNumber = document.getElementById('senderNumber').value.trim();
        // ------------------------------------------

        const fullName = document.getElementById('signupFullname').value.trim();
        const email = document.getElementById('signupEmail').value.trim();
        const username = document.getElementById('signupUsername').value.trim();
        const referralCode = document.getElementById('signupReferralCode').value.trim();
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('signupConfirmPassword').value;

        signupMessage.classList.remove('hidden', 'success', 'error', 'info');
        signupMessage.classList.add('info');
        signupMessage.textContent = 'Processing registration...';

        if (password !== confirmPassword) {
            signupMessage.textContent = 'Error: Passwords do not match.';
            signupMessage.classList.add('error');
            return;
        }

        if (username.length > 15) {
            signupMessage.textContent = 'Error: Username cannot be more than 15 characters.';
            signupMessage.classList.add('error');
            return;
        }

        const accounts = await fetchAccounts();
        if (accounts === null) {
            signupMessage.textContent = 'Error: Please check your internet connection.';
            signupMessage.classList.add('error');
            return;
        }
        
        let referrerAccount = null;
        let newAccountEarning = 0; 
        
        if (referralCode) {
            referrerAccount = accounts.find(acc => acc.refer_code === referralCode);
            
            // ***** FIX: INVALID REFERRAL CODE CHECK *****
            if (!referrerAccount) {
                 signupMessage.textContent = ' Invalid Referral Code provided';
                 signupMessage.classList.remove('info');
                 signupMessage.classList.add('error'); 
                 return; // Invalid code hone par yahin se function stop ho jayega
            }
            // *******************************************
        }
        
        if (accounts.find(acc => acc.username === username)) {
            signupMessage.textContent = 'Error: Username already exists.';
            signupMessage.classList.add('error');
            return;
        }
        if (accounts.find(acc => acc.email === email)) {
            signupMessage.textContent = 'Error: Email already exists.';
            signupMessage.classList.add('error');
            return;
        }
        
        // Create new user object
        const newUser = {
            fullname: fullName,
            email: email,
            username: username,
            password: password,
            earning: newAccountEarning,
            profilePicUrl: DEFAULT_PROFILE_PIC,
            profileFrameUrl: '',
            refer_code: generateRandomCode(),
            referred_by: referrerAccount ? referrerAccount.refer_code : null,
            created_at: new Date().toISOString().split('T')[0],
            wallet: null,
            status: 'UNBANNED', 
            account_permission: 'Pending',
            level: 1, 
            xp: 0,
            // --- NEW PAYMENT FIELDS ---
            paymentMethod: paymentMethod, 
            senderName: senderName,       
            trxId: trxId,                 
            senderNumber: senderNumber,   
            // --------------------------
        };

        let newAccounts = [...accounts, newUser];
        
        const updateResult = await updateAccountsOnBin(newAccounts);

        if (updateResult.success) {
            signupMessage.textContent = 'âœ… Sign Up Successful! Please Log in.';
            signupMessage.classList.add('success');
            setTimeout(() => {
                toggleForm('login');
                signupForm.reset();
            }, 1500);
        } else {
            signupMessage.textContent = `ðŸš¨ Server Error: Failed to save account. ${updateResult.message}`;
            signupMessage.classList.add('error');
        }
    });

    // --- Profile Page Functions ---

    /** Populates the profile form with current user data. */
    function populateProfilePage() {
        if (currentUser) {
            const currentUsername = currentUser.username;
            const profileImageCircle = document.getElementById('profileImageCircle');
            const profileFrameOverlay = document.getElementById('profileFrameOverlay');
            
            // 1. Update Profile Fields
            document.getElementById('profileEmail').value = currentUser.email || 'N/A';
            
            // Username logic...
            const placeholderText = `Enter New Username (${currentUsername.length}/15)`;
            document.getElementById('profileUsername').setAttribute('placeholder', placeholderText);
            document.getElementById('profileUsername').value = currentUsername;
            
            // 2. Update Profile Picture on Profile Page (FIX)
            const imageUrl = (currentUser.profilePicUrl && currentUser.profilePicUrl !== 'null') 
                             ? currentUser.profilePicUrl 
                             : DEFAULT_PROFILE_PIC;
                             
            profileImageCircle.style.backgroundImage = `url('${imageUrl}')`;
            
            // 3. Update Profile Frame Overlay (4. NEW)
            const frameUrl = currentUser.profileFrameUrl || '';
            profileFrameOverlay.style.backgroundImage = frameUrl ? `url('${frameUrl}')` : 'none';
            
            // Set initial temp URL for photo/frame selection
            tempSelectedPhotoUrl = imageUrl; 
            tempSelectedFrameUrl = frameUrl;
        }
    }

    // Event listener for real-time count in placeholder
    usernameInput.addEventListener('input', function() {
        const charCount = this.value.length;
        const newPlaceholder = `Enter New Username (${charCount}/15)`;
        this.setAttribute('placeholder', newPlaceholder);
    });

    // Fix for initial placeholder text
    usernameInput.addEventListener('focus', function() {
        this.setAttribute('placeholder', `Enter New Username (${this.value.length}/15)`);
    });
    usernameInput.addEventListener('blur', function() {
         this.setAttribute('placeholder', `Enter New Username (${this.value.length}/15)`);
    });

    // PROFILE Form Handler (JSON Bin Save)
    document.getElementById('profileForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        // ðŸš¨ Real-time Ban Check before any action
        if (await checkUserStatus()) return;
        
        const newUsername = document.getElementById('profileUsername').value.trim();
        const newPassword = document.getElementById('profilePassword').value;
        const confirmPassword = document.getElementById('profileConfirmPassword').value;
        const profileMessage = document.getElementById('profileMessage');
        
        profileMessage.classList.remove('hidden', 'success', 'error', 'info');
        profileMessage.classList.add('info');
        profileMessage.textContent = 'Saving changes...';

        if (newPassword && newPassword !== confirmPassword) {
            profileMessage.textContent = 'Error: New Password and Confirm Password do not match.';
            profileMessage.classList.add('error');
            return;
        }

        if (newUsername.length > 15) {
            profileMessage.textContent = 'Error: Username cannot be more than 15 characters.';
            profileMessage.classList.add('error');
            return;
        }

        const accounts = await fetchAccounts();
        if (accounts === null) {
            profileMessage.textContent = ' no internet connection.';
            profileMessage.classList.add('error');
            return;
        }

        // Check for duplicate username (excluding current user)
        if (newUsername !== currentUser.username && accounts.find(acc => acc.username === newUsername)) {
            profileMessage.textContent = 'Error: Username already taken.';
            profileMessage.classList.add('error');
            return;
        }
        
        // Find and update the user in the array
        const userIndex = accounts.findIndex(acc => acc.username === currentUser.username);
        if (userIndex !== -1) {
            const updatedUser = { ...accounts[userIndex] };
            
            updatedUser.username = newUsername;
            if (newPassword) {
                updatedUser.password = newPassword;
            }
            // Use the user's existing profilePicUrl/profileFrameUrl (only updated via modals)
            updatedUser.profilePicUrl = currentUser.profilePicUrl; 
            updatedUser.profileFrameUrl = currentUser.profileFrameUrl; // 4. NEW: Preserve frame
            updatedUser.status = currentUser.status; // Preserve status
            updatedUser.level = currentUser.level; // Preserve level
            // âŒ XP property removed
            
            accounts[userIndex] = updatedUser;
            
            const updateResult = await updateAccountsOnBin(accounts);

            if (updateResult.success) {
                // Update global and local storage state
                currentUser = updatedUser;
                localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                
                profileMessage.textContent = 'âœ… Profile changes saved successfully!';
                profileMessage.classList.add('success');
                
                // Refresh header and earnings section
                displayUsername.textContent = updatedUser.username;
                updateHeaderProfilePic();
                
                // Clear password fields after successful save
                document.getElementById('profilePassword').value = '';
                document.getElementById('profileConfirmPassword').value = '';
                
                // Update placeholder text
                document.getElementById('profileUsername').setAttribute('placeholder', `Enter New Username (${newUsername.length}/15)`);

            } else {
                profileMessage.textContent = `ðŸš¨ Server Error: Failed to save changes. ${updateResult.message}`;
                profileMessage.classList.add('error');
            }

        } else {
            profileMessage.textContent = 'Error: Current user not found in database.';
            profileMessage.classList.add('error');
        }

    });
    
    // --- NEW: Profile Option Menu Logic ---
    function toggleProfileMenu(event) {
        event.stopPropagation(); // Prevents clicks outside from immediately closing it
        const menu = document.getElementById('profileOptionMenu');
        // Close frame/photo overlays if open before showing menu
        document.getElementById('photoSelectionOverlay').classList.add('hidden'); 
        document.getElementById('frameSelectionOverlay').classList.add('hidden');
        menu.classList.toggle('hidden');
    }
    window.toggleProfileMenu = toggleProfileMenu;

    // Close the menu when clicking anywhere else
    document.addEventListener('click', function(event) {
        const menu = document.getElementById('profileOptionMenu');
        const icon = document.querySelector('.profile-menu-toggle-icon');
        
        // If the menu is visible and the click wasn't on the menu or the toggle icon, hide it
        if (menu && !menu.classList.contains('hidden') && !menu.contains(event.target) && event.target !== icon) {
            menu.classList.add('hidden');
        }
    });

    // --- Photo Selection Modal Functions ---
    
    /** Sets the filter for the photo grid and updates the UI. */
    function setPhotoFilter(filterType, element) {
        currentPhotoFilter = filterType;
        // Update button states
        document.getElementById('navOwned').classList.remove('active');
        document.getElementById('navAll').classList.remove('active');
        if (element) {
            element.classList.add('active');
        } else if (filterType === 'owned') {
            document.getElementById('navOwned').classList.add('active');
        } else if (filterType === 'all') {
            document.getElementById('navAll').classList.add('active');
        }
        
        // Re-render the grid
        renderPhotoGrid();
    }
    window.setPhotoFilter = setPhotoFilter; // Make accessible

    function renderPhotoGrid() {
        const photoGrid = document.getElementById('photoGrid');
        photoGrid.innerHTML = ''; 
        
        // Filter the photos based on the current filter setting
        const filteredPhotos = PROFILE_PHOTO_LINKS.filter(photo => {
            if (currentPhotoFilter === 'owned') {
                return !photo.isLocked || (currentUser && photo.url === currentUser.profilePicUrl);
            }
            return true; // 'all' filter shows everything
        });

        filteredPhotos.forEach(photo => {
            const item = document.createElement('div');
            item.className = 'photo-item';
            
            // Check if locked and if the user currently owns/is using it
            const isLocked = photo.isLocked && photo.url !== currentUser.profilePicUrl;
            
            if (isLocked) {
                item.classList.add('locked');
            }
            
            // Mark as selected if it matches the temporary selection
            if (photo.url === tempSelectedPhotoUrl) {
                item.classList.add('selected');
            }
            
            item.setAttribute('data-url', photo.url);
            item.innerHTML = `<img src="${photo.url}" alt="Profile Photo">`;
            
            item.addEventListener('click', () => {
                // Only allow selection if not locked
                if (!isLocked) {
                   selectPhoto(item, photo.url);
                } else {
                   // Show a message or do nothing
                   const message = document.getElementById('photoSelectionMessage');
                   message.textContent = 'ðŸš¨ This photo is currently locked!';
                   message.classList.remove('hidden', 'success', 'info');
                   message.classList.add('error');
                }
            });
            photoGrid.appendChild(item);
        });
    }

    // SOLVED PROBLEM: This function is now corrected.
    function showPhotoSelectionMenu(event) {
        event.stopPropagation(); // Stops the click from closing the menu/overlay
        document.getElementById('profileOptionMenu').classList.add('hidden'); // Hide the small menu

        const overlay = document.getElementById('photoSelectionOverlay');
        const currentPhotoDisplay = document.getElementById('currentSelectedPhotoDisplay');
        const photoSelectionMessage = document.getElementById('photoSelectionMessage');
        
        // Hide other overlays
        document.getElementById('frameSelectionOverlay').classList.add('hidden');
        
        // Show the overlay
        overlay.classList.remove('hidden');
        
        // Reset message
        photoSelectionMessage.classList.add('hidden');
        
        // Set the currently active photo as the initial selection
        tempSelectedPhotoUrl = currentUser.profilePicUrl || DEFAULT_PROFILE_PIC;
        currentPhotoDisplay.style.backgroundImage = `url('${tempSelectedPhotoUrl}')`;

        // Reset to 'owned' view by default and render
        setPhotoFilter('owned'); 
    }
    window.showPhotoSelectionMenu = showPhotoSelectionMenu; // Make globally accessible

    function hidePhotoSelection() {
        document.getElementById('photoSelectionOverlay').classList.add('hidden');
    }
    window.hidePhotoSelection = hidePhotoSelection; // Make globally accessible

    function selectPhoto(element, url) {
        // Find the photo object to check lock status
        const photo = PROFILE_PHOTO_LINKS.find(p => p.url === url);
        // Do not allow selection if it's a locked photo and not the current one
        if (photo && photo.isLocked && photo.url !== currentUser.profilePicUrl) {
            return; 
        }
        
        // Remove 'selected' class from all photos
        document.querySelectorAll('.photo-item').forEach(item => {
            item.classList.remove('selected');
        });
        
        // Add 'selected' class to the clicked photo
        element.classList.add('selected');
        
        // Update the temporary selection
        tempSelectedPhotoUrl = url;
        
        // Update the display circle
        document.getElementById('currentSelectedPhotoDisplay').style.backgroundImage = `url('${url}')`;
    }
    
    // SAVE PHOTO BUTTON HANDLER
    document.getElementById('savePhotoBtn').addEventListener('click', async function() {
        if (!currentUser || !tempSelectedPhotoUrl) return;

        // ðŸš¨ Real-time Ban Check before any action
        if (await checkUserStatus()) return;
        
        // Final lock check before saving (in case user selected a locked photo in 'all' view)
        const selectedPhotoObj = PROFILE_PHOTO_LINKS.find(p => p.url === tempSelectedPhotoUrl);
        if (selectedPhotoObj && selectedPhotoObj.isLocked && selectedPhotoObj.url !== currentUser.profilePicUrl) {
            const photoSelectionMessage = document.getElementById('photoSelectionMessage');
            photoSelectionMessage.textContent = 'ðŸš¨ You cannot save a locked photo! Unlock it first.';
            photoSelectionMessage.classList.remove('hidden', 'success', 'info');
            photoSelectionMessage.classList.add('error');
            return;
        }

        const photoSelectionMessage = document.getElementById('photoSelectionMessage');
        photoSelectionMessage.classList.remove('hidden', 'success', 'error', 'info');
        photoSelectionMessage.classList.add('info');
        photoSelectionMessage.textContent = 'Saving new photo...';

        const accounts = await fetchAccounts();
        if (accounts === null) {
            photoSelectionMessage.textContent = 'Error: Failed to load account data. Cannot save photo.';
            photoSelectionMessage.classList.add('error');
            return;
        }

        const userIndex = accounts.findIndex(acc => acc.username === currentUser.username);
        if (userIndex !== -1) {
            const updatedUser = { ...accounts[userIndex] };
            updatedUser.profilePicUrl = tempSelectedPhotoUrl; // Update the photo URL
            accounts[userIndex] = updatedUser;
            
            const updateResult = await updateAccountsOnBin(accounts);

            if (updateResult.success) {
                currentUser = updatedUser;
                localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                
                photoSelectionMessage.textContent = 'âœ… Profile photo saved successfully!';
                photoSelectionMessage.classList.add('success');
                
                // Update the profile page display and header immediately
                document.getElementById('profileImageCircle').style.backgroundImage = `url('${tempSelectedPhotoUrl}')`;
                updateHeaderProfilePic();
                
                setTimeout(() => {
                    hidePhotoSelection();
                    // Show a success message on the main profile page
                    const profileMessage = document.getElementById('profileMessage');
                    profileMessage.textContent = 'âœ… Profile photo updated successfully!';
                    profileMessage.classList.add('success');
                    profileMessage.classList.remove('hidden', 'error');
                }, 1000);

            } else {
                photoSelectionMessage.textContent = `ðŸš¨ Server Error: Failed to save photo. ${updateResult.message}`;
                photoSelectionMessage.classList.add('error');
            }
        }
    });
    
    // --- 4. NEW: Frame Selection Modal Functions ---

    function setFrameFilter(filterType, element) {
        currentFrameFilter = filterType;
        document.getElementById('navFrameOwned').classList.remove('active');
        document.getElementById('navFrameAll').classList.remove('active');
        if (element) {
            element.classList.add('active');
        } else if (filterType === 'owned') {
            document.getElementById('navFrameOwned').classList.add('active');
        } else if (filterType === 'all') {
            document.getElementById('navFrameAll').classList.add('active');
        }
        renderFrameGrid();
    }
    window.setFrameFilter = setFrameFilter;

    function renderFrameGrid() {
        const frameGrid = document.getElementById('frameGrid');
        frameGrid.innerHTML = ''; 
        
        const filteredFrames = PROFILE_FRAME_LINKS.filter(frame => {
            if (currentFrameFilter === 'owned') {
                return !frame.isLocked || (currentUser && frame.url === currentUser.profileFrameUrl);
            }
            return true; 
        });

        filteredFrames.forEach(frame => {
            const item = document.createElement('div');
            item.className = 'frame-item';
            
            const isLocked = frame.isLocked && frame.url !== currentUser.profileFrameUrl;
            
            if (isLocked) {
                item.classList.add('locked');
            }
            
            if (frame.url === tempSelectedFrameUrl) {
                item.classList.add('selected');
            }
            
            const framePreview = document.createElement('div');
            framePreview.className = 'frame-preview';
            if (!frame.url) framePreview.classList.add('no-frame');

            framePreview.style.backgroundImage = frame.url ? `url('${frame.url}')` : 'none';
            item.appendChild(framePreview);
            
            item.setAttribute('data-url', frame.url);
            
            item.addEventListener('click', () => {
                if (!isLocked) {
                   selectFrame(item, frame.url);
                } else {
                   const message = document.getElementById('frameSelectionMessage');
                   message.textContent = `ðŸš¨ ${frame.name} is currently locked!`;
                   message.classList.remove('hidden', 'success', 'info');
                   message.classList.add('error');
                }
            });
            frameGrid.appendChild(item);
        });
    }

    function selectFrame(element, url) {
        const frame = PROFILE_FRAME_LINKS.find(p => p.url === url);
        if (frame && frame.isLocked && frame.url !== currentUser.profileFrameUrl) {
            return; 
        }
        
        document.querySelectorAll('.frame-item').forEach(item => {
            item.classList.remove('selected');
        });
        
        element.classList.add('selected');
        
        tempSelectedFrameUrl = url;
        
        const currentDisplay = document.getElementById('currentSelectedFrameDisplay');
        currentDisplay.style.backgroundImage = url ? `url('${url}')` : 'none';
        currentDisplay.classList.toggle('no-frame-selected', !url);
    }
    
    // SOLVED PROBLEM: This function is now corrected.
    function showFrameSelectionMenu(event) {
        event.stopPropagation(); // Stops the click from closing the menu/overlay
        document.getElementById('profileOptionMenu').classList.add('hidden');
        
        const overlay = document.getElementById('frameSelectionOverlay');
        const currentDisplay = document.getElementById('currentSelectedFrameDisplay');
        const message = document.getElementById('frameSelectionMessage');
        
        document.getElementById('photoSelectionOverlay').classList.add('hidden');
        
        overlay.classList.remove('hidden');
        message.classList.add('hidden');
        
        tempSelectedFrameUrl = currentUser.profileFrameUrl || '';
        currentDisplay.style.backgroundImage = tempSelectedFrameUrl ? `url('${tempSelectedFrameUrl}')` : 'none';
        currentDisplay.classList.toggle('no-frame-selected', !tempSelectedFrameUrl);
        
        setFrameFilter('owned'); 
    }
    window.showFrameSelectionMenu = showFrameSelectionMenu;

    function hideFrameSelection() {
        document.getElementById('frameSelectionOverlay').classList.add('hidden');
    }
    window.hideFrameSelection = hideFrameSelection; 

    // SAVE FRAME BUTTON HANDLER
    document.getElementById('saveFrameBtn').addEventListener('click', async function() {
        if (!currentUser) return;

        if (await checkUserStatus()) return;
        
        const selectedFrameObj = PROFILE_FRAME_LINKS.find(p => p.url === tempSelectedFrameUrl);
        if (selectedFrameObj && selectedFrameObj.isLocked && selectedFrameObj.url !== currentUser.profileFrameUrl) {
            const message = document.getElementById('frameSelectionMessage');
            message.textContent = 'ðŸš¨ You cannot save a locked frame!';
            message.classList.remove('hidden', 'success', 'info');
            message.classList.add('error');
            return;
        }

        const frameSelectionMessage = document.getElementById('frameSelectionMessage');
        frameSelectionMessage.classList.remove('hidden', 'success', 'error', 'info');
        frameSelectionMessage.classList.add('info');
        frameSelectionMessage.textContent = 'Saving new frame...';

        const accounts = await fetchAccounts();
        if (accounts === null) {
            frameSelectionMessage.textContent = 'Error: Failed to load account data. Cannot save frame.';
            frameSelectionMessage.classList.add('error');
            return;
        }

        const userIndex = accounts.findIndex(acc => acc.username === currentUser.username);
        if (userIndex !== -1) {
            const updatedUser = { ...accounts[userIndex] };
            updatedUser.profileFrameUrl = tempSelectedFrameUrl; 
            accounts[userIndex] = updatedUser;
            
            const updateResult = await updateAccountsOnBin(accounts);

            if (updateResult.success) {
                currentUser = updatedUser;
                localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                
                frameSelectionMessage.textContent = 'âœ… Profile frame saved successfully!';
                frameSelectionMessage.classList.add('success');
                
                // Update the profile page display immediately
                const profileFrameOverlay = document.getElementById('profileFrameOverlay');
                profileFrameOverlay.style.backgroundImage = tempSelectedFrameUrl ? `url('${tempSelectedFrameUrl}')` : 'none';
                
                setTimeout(() => {
                    hideFrameSelection();
                    const profileMessage = document.getElementById('profileMessage');
                    profileMessage.textContent = 'âœ… Profile frame updated successfully!';
                    profileMessage.classList.add('success');
                    profileMessage.classList.remove('hidden', 'error');
                }, 1000);

            } else {
                frameSelectionMessage.textContent = `ðŸš¨ Server Error: Failed to save frame. ${updateResult.message}`;
                frameSelectionMessage.classList.add('error');
            }
        }
    });
    
// Task Page specific logic
let submissionHistoryTask = []; // Separate history array for this task (now mostly handled by JSONBin)

function validateGmailTask(inputElement) {
    const gmailRegex = /^[\w.-]+@gmail\.com$/i; 
    if (!gmailRegex.test(inputElement.value)) {
        inputElement.style.border = '2px solid red';
        return false;
    } else {
        inputElement.style.border = '1px solid #ccc';
        return true;
    }
}

// 1 & 2: Quantity and Dynamic Gmail Inputs
function generateGmailInputsTask() {
    const quantityInput = document.getElementById('quantityInputTask');
    const container = document.getElementById('gmailInputsContainerTask');
    let quantity = parseInt(quantityInput.value);

    if (isNaN(quantity) || quantity < 0) {
        quantity = 1;
        quantityInput.value = 1; // Default to 1 instead of 0
    } else if (quantity > 20) {
        quantity = 20;
        quantityInput.value = 20;
    }
    
    container.innerHTML = ''; 

    for (let i = 0; i < quantity; i++) {
        const input = document.createElement('input');
        input.type = 'email';
        input.id = `gmailTask_${i}`;
        input.placeholder = `Enter Gmail ${i + 1} (e.g., user${i+1}@gmail.com)`;
        input.className = 'gmail-input-task';
        input.onblur = function() { validateGmailTask(this); };
        container.appendChild(input);
    }
}

// --- JSONBIN HELPER FUNCTIONS (Assuming TASK_BIN_URL and API_KEY are defined) ---

async function loadTaskHistoryFromBin() {
    try {
        const response = await fetch(TASK_BIN_URL, {
            method: 'GET',
            headers: {
                'X-Master-Key': API_KEY,
            },
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        // Task data is stored in the 'record' property of the response
        return data.record || []; 
    } catch (error) {
        console.error("Error loading task history from JSONBin:", error);
        // Default to an empty array on failure
        return []; 
    }
}

async function saveTaskHistoryToBin(newHistory) {
    try {
        const response = await fetch(TASK_BIN_URL, {
            method: 'PUT', // PUT request to update the entire bin
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': API_KEY,
            },
            body: JSON.stringify(newHistory),
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        return await response.json();
    } catch (error) {
        console.error("Error saving task history to JSONBin:", error);
        return null;
    }
}

// --- NEW FUNCTION: Task Deletion Logic ---
async function deleteTaskEntry(submissionId) {
    if (!confirm('no internat connection "Deleted" à¤®à¥‡à¤‚ à¤¬à¤¦à¤² à¤¦à¥‡à¤—à¤¾à¥¤')) {
        return; // User cancelled
    }

    // 1. Load current history from JSONBin
    const currentHistory = await loadTaskHistoryFromBin();
    let updated = false;

    // 2. Find the entry and update its status
    const updatedHistory = currentHistory.map(entry => {
        // ID comparison ensures we update the correct entry
        // Use loose equality (==) for consistency with entry.id generated by Date.now()
        if (entry.id == submissionId) { 
            entry.status = 'Deleted';
            updated = true;
        }
        return entry;
    });

    if (updated) {
        // 3. Save the updated history back to JSONBin
        const saveResult = await saveTaskHistoryToBin(updatedHistory);

        if (saveResult) {
            alert('âœ… Task status updated to "Deleted".');
            // 4. Re-render the history to reflect the change
            renderHistoryTask(updatedHistory);
        } else {
            alert('âŒ à¤¸à¥à¤¥à¤¿à¤¤à¤¿ à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤µà¤¿à¤«à¤² à¤°à¤¹à¤¾à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤ªà¥à¤¨: à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚à¥¤');
        }
    } else {
        console.warn('Submission ID not found:', submissionId);
    }
}


// 3. SUBMIT Option
async function submitGmailsTask() { 
    const gmailInputs = document.querySelectorAll('.gmail-input-task');
    const validGmails = [];
    let allValid = true;

    // Validation
    gmailInputs.forEach(input => {
        const email = input.value.trim();
        const isValid = validateGmailTask(input); 

        if (isValid) {
            validGmails.push(email);
        } else if (!email) {
            allValid = false;
            input.style.border = '2px solid orange'; // Empty field alert
        } else {
             allValid = false;
        }
    });

    if (!allValid || validGmails.length !== gmailInputs.length) {
        alert('âŒ Submission failed. Please ensure all fields are filled and valid (example@gmail.com).');
        return;
    }

    // 1. Load current history from JSONBin
    const currentHistory = await loadTaskHistoryFromBin();

    // 2. Create new entries with PENDING status for each Gmail
    const now = new Date();
    const date = now.toLocaleDateString();
    const time = now.toLocaleTimeString();

    const newSubmissions = validGmails.map(gmail => {
        return {
            username: currentUser.username, 
            id: Date.now() + Math.random(), // Unique ID for each entry
            date: date,
            time: time,
            gmail: gmail, 
            status: 'Pending' 
        };
    });
    
    // 3. Add new entries to the start of the current history (newest first)
    const updatedHistory = [...newSubmissions, ...currentHistory];

    // 4. Save the updated history back to JSONBin
    const saveResult = await saveTaskHistoryToBin(updatedHistory);
    
    if (saveResult) {
        // Reset inputs
        gmailInputs.forEach(input => input.value = '');
        document.getElementById('quantityInputTask').value = 1;
        generateGmailInputsTask();
        
        alert(`âœ… Success! ${validGmails.length} GMAILs submitted with status 'Pending'.`);
        
        // Render history from the newly saved data
        renderHistoryTask(updatedHistory);
    } else {
        alert('âŒ Submission failed due to a server error. Please try again.');
    }
}


// 4. History and 'Show all' (UPDATED with Delete Menu)
async function renderHistoryTask(historyOverride) {
    const historyList = document.getElementById('historyListTask');
    historyList.innerHTML = '';
    
    // 1. Load full history
    const fullHistory = historyOverride || await loadTaskHistoryFromBin();

    // 2. FILTER TASKS: Sirf current user ke tasks ko select karega
    const userTasks = fullHistory.filter(entry => 
        entry.username === currentUser.username
    );

    // 3. EMPTY STATE
    if (userTasks.length === 0) {
        historyList.innerHTML = `
            <div style="text-align: center; padding: 20px; background-color: #f8f8f8; border-radius: 8px; margin-top: 15px; border: 1px dashed #038203;">
                <p style="font-size: 1.1em; color: #555;">
                    <i class="fas fa-clipboard-list" style="margin-right: 8px; color: #038203;"></i>
                    **Not yet task** submitted.
                </p>
                <p style="color: #888; font-size: 0.9em;">
                    Apni task history yahan dekhne ke liye task submit karein.
                </p>
            </div>
        `;
        return;
    }

    // 4. Display the filtered tasks
    userTasks.forEach(entry => {
        const historyBlock = document.createElement('div');
        historyBlock.style.marginBottom = '15px';
        historyBlock.style.padding = '10px';
        historyBlock.style.border = '1px solid #eee';
        historyBlock.style.borderRadius = '4px';

        const statusClass = entry.status.toLowerCase();
        
        const item = document.createElement('div');
        item.className = 'history-item-task';
        // Note: Using a data attribute is good practice, but the ID is passed to deleteTaskEntry via onclick
        // item.setAttribute('data-submission-id', entry.id); 

        item.innerHTML = `
            <div style="margin-bottom: 5px; font-size: 0.95em;">
            </div>
            <div class="history-content">
                <span class="history-gmail">${entry.gmail}</span>
                <span class="history-datetime">${entry.date} ${entry.time}</span>
                <span class="status-task ${statusClass}">${statusClass}</span>
                
                <div class="dropdown-menu-task">
                    <button class="menu-btn-task" onclick="this.nextElementSibling.classList.toggle('show'); event.stopPropagation();">...</button>
                    <div class="menu-content-task">
                        <a href="#" onclick="event.preventDefault(); deleteTaskEntry(${entry.id}); this.parentElement.classList.remove('show');">Delete</a>
                    </div>
                </div>
            </div>
        `;
        historyBlock.appendChild(item);
        historyList.appendChild(historyBlock);
    });
    
    // NEW: Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
        // Check if the click target is NOT the menu button
        if (!event.target.matches('.menu-btn-task')) {
            const dropdowns = document.getElementsByClassName("menu-content-task");
            for (let i = 0; i < dropdowns.length; i++) {
                const openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
}

// --- HELPER FUNCTIONS FOR JSONBIN ---

// Fetch data from a bin
async function fetchBinData(url) {
    try {
        const response = await fetch(url + '/latest', {
            method: 'GET',
            headers: {
                'X-Master-Key': API_KEY,
            },
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        return data.record; 
    } catch (error) {
        console.error('Error fetching bin data:', error);
        return null;
    }
}

// Update data in a bin
async function updateBinData(url, data) {
    try {
        const response = await fetch(url, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': API_KEY,
            },
            body: JSON.stringify(data),
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        return await response.json();
    } catch (error) {
        console.error('Error updating bin data:', error);
        return null;
    }
}


// --- Function to Load Withdrawal History (Current User ki history) ---
// Isme koi change nahi hai, yeh history load karne ke liye theek hai.
async function loadWithdrawalHistory() {
    // ðŸš¨ Check: Ensure currentUser object globally available hai
    if (typeof currentUser === 'undefined' || !currentUser.username) {
        document.getElementById('withdrawalHistoryList').innerHTML = '<p class="error">âŒ Current user details available nahi hain. Please login.</p>';
        return;
    }

    const historyList = document.getElementById('withdrawalHistoryList');
    historyList.innerHTML = '<p class="info" style="text-align: center;">â³ Loading your withdrawal history...</p>';
    
    // 1. Load full history (WITHDRAWAL_BIN_ID globally available hona chahiye)
    const fullHistory = await fetchBinData(`https://api.jsonbin.io/v3/b/${WITHDRAWAL_BIN_ID}`);

    // 2. FILTER WITHDRAWALS: Sirf current user ke tasks ko select karega
    const currentUserWithdrawals = (fullHistory || []).filter(entry => 
        entry.username === currentUser.username
    );

    // 3. EMPTY STATE
    if (currentUserWithdrawals.length === 0) {
        historyList.innerHTML = `
            <div style="text-align: center; padding: 20px; background-color: #f8f8f8; border-radius: 8px; margin-top: 15px; border: 1px dashed #038203;">
                <p style="font-size: 1.1em; color: #555;">
                    <i class="fas fa-history" style="margin-right: 8px; color: #038203;"></i>
                    No withdrawal requests submitted yet by you.
                </p>
            </div>
        `;
        return;
    }

    // 4. Display the withdrawals (Newest first)
    const sortedWithdrawals = currentUserWithdrawals.sort((a, b) => {
        const dateA = new Date(a.date || 0);
        const dateB = new Date(b.date || 0);
        return dateB - dateA; // Naya record pehle
    });

    let html = '<ul class="history-list">';
    sortedWithdrawals.forEach(entry => {
        const status = entry.status ? entry.status.toUpperCase() : 'PENDING';
        const statusClass = status.toLowerCase(); 

        const amount = parseFloat(entry.amount || 0).toFixed(2);
        const date = entry.date || 'Date N/A';
        const method = entry.method || 'Method N/A';
        
        html += `
            <li class="history-item">
                <span class="history-date">${date}</span>
                <span class="history-amount">â‚±${amount}</span>
                <span class="history-method">${method}</span>
                <span class="history-status ${statusClass}">${status}</span>
            </li>
        `;
    });
    
    html += '</ul>';
    historyList.innerHTML = html;
}


// --- WITHDRAW Form Handler (Submission Logic) ---
// *** Yahan changes kiye gaye hain ***

document.getElementById('withdrawForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    
    // Real-time Ban Check 
    if (await checkUserStatus()) return;
    
    const amount = parseFloat(document.getElementById('withdrawAmount').value);
    const method = document.getElementById('walletMethod').value;
    const name = document.getElementById('walletName').value.trim();
    const number = document.getElementById('walletNumber').value.trim();
    const withdrawMessage = document.getElementById('withdrawMessage');
    
    // Refresh currentUser to get latest earning
    await checkUserStatus(); 
    const userEarning = currentUser ? parseFloat(currentUser.earning || 0) : 0;
    
    // Clear previous states before validation
    withdrawMessage.classList.remove('hidden', 'success', 'error', 'info');

    // --- Validation Checks ---
    if (isNaN(amount) || amount <= 0) {
        withdrawMessage.textContent = 'ðŸš¨ Please enter a valid amount greater than 0.';
        withdrawMessage.classList.add('error');
    } else if (amount < 1) { // Minimum â‚±1
        withdrawMessage.textContent = 'ðŸš¨ Minimum withdrawal amount is â‚±1.';
        withdrawMessage.classList.add('error');
    } else if (userEarning < amount) { // Check balance
        withdrawMessage.textContent = `ðŸš¨ First check balance! Your current earnings (â‚±${userEarning.toFixed(2)}) are too low for â‚±${amount.toFixed(2)} withdrawal.`;
        withdrawMessage.classList.add('error');
    } else if (!method || !name || !number) { // Check details
         withdrawMessage.textContent = `ðŸš¨ Please fill all payment details (Method, Name, Number).`;
         withdrawMessage.classList.add('error');
    }
    // New Feature 3: Check for maximum pending withdrawals (2 pending requests allowed)
    else {
        // Full history dobara load karna padega latest data ke liye
        const fullHistory = await fetchBinData(`https://api.jsonbin.io/v3/b/${WITHDRAWAL_BIN_ID}`);
        
        // Current user ke 'PENDING' requests count karo
        const pendingRequests = (fullHistory || []).filter(entry => 
            entry.username === currentUser.username && entry.status && entry.status.toUpperCase() === 'PENDING'
        );
        
        if (pendingRequests.length >= 2) {
             withdrawMessage.textContent = `ðŸš¨ Bug Update! Already ap ke username se **${pendingRequests.length} withdraw Pending** ma ha tu ap 3rd SUMBIT NAHI kar sakh te.`;
             withdrawMessage.classList.add('error');
        } 
        else {
            // --- Submission Logic ---
            
            const requestData = {
                user_id: currentUser.id, 
                username: currentUser.username,
                amount: amount,
                method: method,
                name: name,
                number: number,
                date: new Date().toISOString().split('T')[0], // Adding date for history
                status: 'PENDING' // Initial status
            };

            // Submission save hoga (saveWithdrawalRequest must be defined)
            const saveSuccess = await saveWithdrawalRequest(requestData);

            if (saveSuccess) {
                // 1. Deduct the amount from user's earning
                currentUser.earning = (userEarning - amount).toFixed(2);
                await updateUserData(currentUser.id, currentUser); 

                // 2. Show the requested success message (Fix 2)
                withdrawMessage.textContent = 'âœ… **Withdrawal Successful!** You will get your money soon. Thanks for using our service!';
                withdrawMessage.classList.add('success');

                // 3. Clear the form
                document.getElementById('withdrawForm').reset();
                
                // 4. Reload the history section (Fix 1)
                // New withdrawal request history mein turant dikhega
                await loadWithdrawalHistory(); 
                
            } else {
                // Submission failed
                withdrawMessage.textContent = 'âŒ Error submitting withdrawal request. Please try again.'; 
                withdrawMessage.classList.add('error');
            }
        }
    }
    // Agar koi bhi message set hua hai, toh use visible karein
    withdrawMessage.classList.remove('hidden');
});

// --- Initial Load ---
document.addEventListener('DOMContentLoaded', () => {
     setTimeout(() => {
         // Typo fix: document
         if (document.getElementById('withdrawalHistoryList')) {
             loadWithdrawalHistory(); 
         }
     }, 500); // 500ms (0.5 second) ka delay
});
    // --- Help Page Functions ---
    // FAQ Toggle
    function toggleFAQ(element) {
        const answer = element.nextElementSibling;
        const icon = element.querySelector('i');
        if (answer.style.display === 'block') {
            answer.style.display = 'none';
            icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
        } else {
            answer.style.display = 'block';
            icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
        }
    }
    window.toggleFAQ = toggleFAQ; // Make function globally accessible from inline HTML
    
    // --- Level Page Functions ---
    
function populateLevelPage() {
    if (!currentUser) return;
    
    const levelContainer = document.getElementById('levelListContainer');
    const currentLevelDisplay = document.getElementById('currentLevelDisplay');
    // âŒ XP display elements removed
    
    // 1. Level à¤•à¥‹ JSON à¤¡à¥‡à¤Ÿà¤¾ à¤¸à¥‡ à¤¸à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚à¥¤
    currentLevelDisplay.textContent = currentUser.level;
    
    // ADD THE NEW CODE HERE (XP DISPLAY FIX)
    if (document.getElementById('currentXPDisplay')) {
        document.getElementById('currentXPDisplay').textContent = currentUser.xp || 0;
    }
    // ------------------------------------
    
    // 2. âŒ XP Calculation and display logic removed
    
    levelContainer.innerHTML = '';
    const totalLevels = 100;
    
    for (let lv = 1; lv <= totalLevels; lv++) {
        const isUnlocked = lv <= currentUser.level;
        const item = document.createElement('div');
        item.className = `lv-item ${isUnlocked ? 'unlocked' : 'locked'}`;
        
        // âœ… CORRECTED: Removed all XP mentions from the right side content
        const rightSideContent = isUnlocked
            ? `<button>COMPLETED</button>`
            : `<span>REACH LV ${lv} TO UNLOCK</span><button disabled style="background-color: #ccc; cursor: not-allowed;">UNAVAILABLE</button>`;
        
        item.innerHTML = `
            <div class="lv-item-info">
                LV. ${lv}
            </div>
            <div class="lv-right-side ${isUnlocked ? 'unlocked' : 'locked'}">
                ${rightSideContent}
            </div>
        `;
        
        levelContainer.appendChild(item);
    }
}


// Append this at the bottom of your Java file or in your page's init function
document.addEventListener('DOMContentLoaded', () => {
    // Initial call to generate a default input box
    generateGmailInputsTask();
    // Load and render history from JSONBin on page load
    renderHistoryTask(); 
});

// --- Team Page Functions ---

/** Renders the list of referrals into the specified container. */
function renderReferralList(containerId, members) {
    const container = document.getElementById(containerId);
    
    // Yeh line "Loading..." text ko remove kar degi
    // Pehle <h4> title ko save karein
    const titleElement = container.querySelector('h4');
    const title = titleElement ? titleElement.outerHTML : '';
    container.innerHTML = title; // Container ko clear karke title wapas dalen

    if (members.length === 0) {
        let statusName = containerId.replace('ReferralList', '');
        statusName = statusName.charAt(0).toUpperCase() + statusName.slice(1).toLowerCase();
        container.innerHTML += `<p style="text-align: center; color: #888; padding-top: 10px;">No ${statusName} referrals found.</p>`;
        return;
    }

    // List items banana aur container mein add karna
    members.forEach(member => {
        let statusClass = 'status-info'; // Default
        // account_permission field se status check ho raha hai
        if (member.account_permission === 'Success') {
            statusClass = 'status-success';
        } else if (member.account_permission === 'Pending') {
            statusClass = 'status-warning';
        } else if (member.account_permission === 'Rejected') {
            statusClass = 'status-error';
        }
        
        // **CORRECTION:** Join Date ke liye 'created_at' field use ho raha hai
        const dateStr = new Date(member.created_at || Date.now()).toLocaleDateString('en-US'); 
        
        const memberHtml = `
            <div class="ref-member">
                <div style="display: flex; align-items: center;">
                    <div class="member-photo" style="background-image: url('${member.profilePicUrl || DEFAULT_PROFILE_PIC}');"></div>
                    <div class="member-detail">
                        <strong>${member.username}</strong>
                        <span class="member-date">Joined: ${dateStr}</span>
                    </div>
                </div>
                <div class="member-status">
                    <span class="${statusClass}">${member.account_permission}</span>
                </div>
            </div>
        `;
        container.innerHTML += memberHtml;
    });
}
window.renderReferralList = renderReferralList;

/** Renders the Team page content (counts and lists). */
async function renderTeamPage() {
    if (!currentUser) return;
    
    // 1. Fetch all accounts and find referred members
    // NOTE: Yeh 'fetchAccounts()' function aapke JSON data ko load karta hai
    const accounts = await fetchAccounts();
    if (!accounts) {
        console.error("Failed to fetch accounts for team page.");
        return;
    }
    
    // Filter to find all accounts referred by the current user
    // referred_by field ko current user ke refer_code se match kiya ja raha hai
    const referredMembers = accounts.filter(acc => acc.referred_by === currentUser.refer_code);

    // 2. Filter referred members by status
    const successMembers = referredMembers.filter(m => m.account_permission === 'Success');
    const pendingMembers = referredMembers.filter(m => m.account_permission === 'Pending');
    const rejectedMembers = referredMembers.filter(m => m.account_permission === 'Rejected');

    // 3. Update the Count Displays
    document.getElementById('referralCodeDisplay').textContent = currentUser.refer_code || 'N/A';
    document.getElementById('totalRefersCountDisplay').textContent = referredMembers.length;
    document.getElementById('successRefersCountDisplay').textContent = successMembers.length;
    document.getElementById('pendingRefersCountDisplay').textContent = pendingMembers.length;
    document.getElementById('rejectedRefersCountDisplay').textContent = rejectedMembers.length;

    // 4. Render the specific lists (Yeh calls 'Loading...' ko replace kar denge)
    renderReferralList('successReferralList', successMembers);
    renderReferralList('pendingReferralList', pendingMembers);
    renderReferralList('rejectedReferralList', rejectedMembers);
}
window.renderTeamPage = renderTeamPage;
// --- TASK PAGE LOGIC (USER REQUEST) ---

// 1. Quantity Option & 2. Gmail Box Generation
function handleQuantityChange() {
    const quantityInput = document.getElementById('taskQuantity');
    let quantity = parseInt(quantityInput.value) || 0;
    
    // Enforce min/max rules
    if (quantity < 1) quantity = 1;
    if (quantity > 20) quantity = 20;
    quantityInput.value = quantity;

    const container = document.getElementById('gmailInputsContainer');
    container.innerHTML = ''; // Clear existing inputs

    for (let i = 1; i <= quantity; i++) {
        const inputHtml = `
            <div class="form-group">
                <label for="gmail_${i}">2ï¸âƒ£ Enter Gmail ${i} (example@gmail.com)</label>
                <input type="email" id="gmail_${i}" class="gmail-input" 
                       placeholder="example@gmail.com" 
                       pattern="[a-zA-Z0-9._%+-]+@gmail\\.com$" 
                       required>
            </div>
        `;
        container.innerHTML += inputHtml;
    }
}

// 3. Submit Option
document.getElementById('taskForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const quantity = parseInt(document.getElementById('taskQuantity').value);
    const gmails = [];
    const messageDisplay = document.getElementById('taskMessage');
    messageDisplay.classList.add('hidden');
    messageDisplay.textContent = '';
    
    let isValid = true;
    // Gmail validation (only allowed example@gmail.com)
    const gmailPattern = /^[a-zA-Z0-9._%+-]+@gmail\.com$/; 

    for (let i = 1; i <= quantity; i++) {
        const input = document.getElementById(`gmail_${i}`);
        if (input) {
            if (!gmailPattern.test(input.value)) {
                isValid = false;
                break;
            }
            gmails.push(input.value);
        }
    }

    if (!isValid) {
        messageDisplay.textContent = 'ERROR: Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… Ø®Ø§Ù†ÙˆÚº Ù…ÛŒÚº ØµØ±Ù @gmail.com ÙØ§Ø±Ù…ÛŒÙ¹ Ú©Ø§ Ø§ÛŒ Ù…ÛŒÙ„ Ø§ÛŒÚˆØ±ÛŒØ³ Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚºÛ”';
        messageDisplay.classList.remove('hidden');
        messageDisplay.classList.add('error');
        return;
    }
    
    if (gmails.length !== quantity) {
         messageDisplay.textContent = 'ERROR: Quantity Ú©Û’ Ù…Ø·Ø§Ø¨Ù‚ Gmail Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù¾ÙˆØ±ÛŒ Ù†ÛÛŒÚº ÛÛ’Û”';
         messageDisplay.classList.remove('hidden');
         messageDisplay.classList.add('error');
         return;
    }

// ... submitGmailsTask function ke andar
// 2. Create new entries with P...
const newEntry = {
    id: Date.now(),
    username: currentUser.username,
    quantity: validGmails.length,
    status: 'Pending',
    date: new Date().toLocaleDateString('en-US'),
    time: new Date().toLocaleTimeString('en-US'),
    // ðŸš¨ FIX: GMAILs ki list ko 'gmails' property mein add karein
    gmails: validGmails, // <-- Ye line add karein
};
    
    // Add to history and update display
    taskHistory.unshift(newTask); // Add to the start for newest first
    renderTaskHistory();

    // Reset form and show success
    document.getElementById('taskForm').reset();
    document.getElementById('taskQuantity').value = 1; // Set quantity back to 1
    handleQuantityChange(); // Reset input fields
    
    messageDisplay.textContent = 'SUCCESS: Task Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¬Ù…Ø¹ (Submitted) Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’!';
    messageDisplay.classList.remove('hidden', 'error');
    messageDisplay.classList.add('success');
});

// 4. History Display
function renderTaskHistory() {
    const container = document.getElementById('taskHistoryContainer');
    container.innerHTML = '';
    
    if (taskHistory.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #777;">No history yet.</p>';
        return;
    }

    taskHistory.forEach((task, index) => {
        const isMulti = task.quantity > 1;
        const statusClass = 'status-' + task.status.toLowerCase();
        
        // 1. Gmail Display: Show only the first Gmail
        let gmailDisplay = `<li style="font-weight: bold;">${task.gmails[0]}</li>`;
        let showAllButton = '';
        
        if (isMulti) {
            // Add a hidden list for other gmails (2-20 tak)
            const otherGmailsHtml = task.gmails.slice(1).map(g => `<li>${g}</li>`).join('');
            
            // The Show all/Hide button logic
            gmailDisplay += `
                <ul id="gmailList_${index}" class="history-gmail-list hidden">
                    ${otherGmailsHtml}
                </ul>
            `;
            showAllButton = `
                <a class="show-all-btn" onclick="toggleGmailList(${index})">
                    Show all (${task.quantity - 1} more)
                </a>
            `;
        }
        
        const itemHtml = `
            <div class="history-item">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span style="font-weight: bold;">Gmail:</span>
                        <span class="history-status ${statusClass}">${task.status}</span>
                    </div>
                    <div style="font-size: 0.8em; color: #888; text-align: right;">
                        <span style="display: block;">${task.date}</span>
                        <span style="display: block;">${task.time}</span>
                    </div>
                </div>
                <ul class="history-gmail-list">
                    ${gmailDisplay}
                </ul>
                ${showAllButton}
            </div>
        `;
        container.innerHTML += itemHtml;
    });
}

function toggleGmailList(index) {
    const list = document.getElementById(`gmailList_${index}`);
    const button = list.nextElementSibling; // The 'Show all' button is the next sibling
    
    if (list.classList.contains('hidden')) {
        list.classList.remove('hidden');
        button.textContent = 'Hide';
    } else {
        list.classList.add('hidden');
        const quantity = taskHistory[index].quantity;
        button.textContent = `Show all (${quantity - 1} more)`;
    }
}
</script>
</body>
</html>
